{"remainingRequest":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\U3W-AIProject\\U3W-AI\\cube-ui\\src\\views\\wechat\\chrome\\index.vue?vue&type=script&lang=js","dependencies":[{"path":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\src\\views\\wechat\\chrome\\index.vue","mtime":1753157550146},{"path":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1752387764959},{"path":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\node_modules\\babel-loader\\lib\\index.js","mtime":1752387764613},{"path":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1752387764959},{"path":"D:\\U3W-AIProject\\U3W-AI\\cube-ui\\node_modules\\vue-loader\\lib\\index.js","mtime":1752387756652}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBtYXJrZWQgfSBmcm9tICJtYXJrZWQiOw0KaW1wb3J0IHsNCiAgbWVzc2FnZSwNCiAgc2F2ZVVzZXJDaGF0RGF0YSwNCiAgZ2V0Q2hhdEhpc3RvcnksDQogIHB1c2hBdXRvT2ZmaWNlLA0KfSBmcm9tICJAL2FwaS93ZWNoYXQvYWlnYyI7DQppbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICJ1dWlkIjsNCmltcG9ydCB3ZWJzb2NrZXRDbGllbnQgZnJvbSAiQC91dGlscy93ZWJzb2NrZXQiOw0KaW1wb3J0IHN0b3JlIGZyb20gIkAvc3RvcmUiOw0KaW1wb3J0IFR1cm5kb3duU2VydmljZSBmcm9tICJ0dXJuZG93biI7DQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkFJTWFuYWdlbWVudFBsYXRmb3JtIiwNCiAgZGF0YSgpIHsNCiAgICByZXR1cm4gew0KICAgICAgdXNlcklkOiBzdG9yZS5zdGF0ZS51c2VyLmlkLA0KICAgICAgY29ycElkOiBzdG9yZS5zdGF0ZS51c2VyLmNvcnBfaWQsDQogICAgICBjaGF0SWQ6IHV1aWR2NCgpLA0KICAgICAgZXhwYW5kZWRIaXN0b3J5SXRlbXM6IHt9LA0KICAgICAgdXNlckluZm9SZXE6IHsNCiAgICAgICAgdXNlclByb21wdDogJycsDQogICAgICAgIHVzZXJJZDogJycsDQogICAgICAgIGNvcnBJZDogJycsDQogICAgICAgIHRhc2tJZDogJycsDQogICAgICAgIHJvbGVzOiAnJywNCiAgICAgICAgdG9uZUNoYXRJZDogJycsDQogICAgICAgIHliRHNDaGF0SWQ6ICcnLA0KICAgICAgICBkYkNoYXRJZDogJycsDQogICAgICAgIHpoQ2hhdElkOiAnJywNCiAgICAgICAgaXNOZXdDaGF0OiB0cnVlLA0KICAgICAgfSwNCiAgICAgIGpzb25ScGNSZXFlc3Q6IHsNCiAgICAgICAganNvbnJwYzogIjIuMCIsDQogICAgICAgIGlkOiB1dWlkdjQoKSwNCiAgICAgICAgbWV0aG9kOiAiIiwNCiAgICAgICAgcGFyYW1zOiB7fSwNCiAgICAgIH0sDQogICAgICBhaUxpc3Q6IFsNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICdEZWVwU2VlaycsDQogICAgICAgICAgYXZhdGFyOiByZXF1aXJlKCcuLi8uLi8uLi9hc3NldHMvbG9nby9EZWVwc2Vlay5wbmcnKSwNCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICLmt7HluqbmgJ3ogIMiLCB2YWx1ZTogImRlZXBfdGhpbmtpbmciIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAi6IGU572R5pCc57SiIiwgdmFsdWU6ICJ3ZWJfc2VhcmNoIiB9LA0KICAgICAgICAgIF0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsiZGVlcF90aGlua2luZyIsICJ3ZWJfc2VhcmNoIl0sDQogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwNCiAgICAgICAgICBzdGF0dXM6ICJpZGxlIiwNCiAgICAgICAgICBwcm9ncmVzc0xvZ3M6IFtdLA0KICAgICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsDQogICAgICAgIH0sDQogICAgICAgIHsgICAgIA0KICAgICAgICAgIG5hbWU6ICfnn6XkuY7nm7TnrZQnLA0KICAgICAgICAgIGF2YXRhcjogcmVxdWlyZSgnLi4vLi4vLi4vYXNzZXRzL2FpL3poaWh1LnBuZycpLA0KICAgICAgICAgIGNhcGFiaWxpdGllczogWw0KICAgICAgICAgICAgeyBsYWJlbDogJ+a3seW6puaAneiAgycsIHZhbHVlOiAnZGVlcF90aGlua2luZycgfQ0KICAgICAgICAgIF0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsnZGVlcF90aGlua2luZyddLA0KICAgICAgICAgIGVuYWJsZWQ6IHRydWUsDQogICAgICAgICAgc3RhdHVzOiAnaWRsZScsDQogICAgICAgICAgcHJvZ3Jlc3NMb2dzOiBbXSwNCiAgICAgICAgICBpc0V4cGFuZGVkOiB0cnVlDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAi6LGG5YyFIiwNCiAgICAgICAgICBhdmF0YXI6IHJlcXVpcmUoIi4uLy4uLy4uL2Fzc2V0cy9haS/osYbljIUucG5nIiksDQogICAgICAgICAgY2FwYWJpbGl0aWVzOiBbeyBsYWJlbDogIua3seW6puaAneiAgyIsIHZhbHVlOiAiZGVlcF90aGlua2luZyIgfV0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsiZGVlcF90aGlua2luZyJdLA0KICAgICAgICAgIGVuYWJsZWQ6IHRydWUsDQogICAgICAgICAgc3RhdHVzOiAiaWRsZSIsDQogICAgICAgICAgcHJvZ3Jlc3NMb2dzOiBbXSwNCiAgICAgICAgICBpc0V4cGFuZGVkOiB0cnVlLA0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogIk1pbmlNYXggQ2hhdCIsDQogICAgICAgICAgYXZhdGFyOiByZXF1aXJlKCIuLi8uLi8uLi9hc3NldHMvYWkvTWluaU1heC5wbmciKSwNCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICLmt7HluqbmgJ3ogIMiLCB2YWx1ZTogImRlZXBfdGhpbmtpbmciIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAi6IGU572R5pCc57SiIiwgdmFsdWU6ICJ3ZWJfc2VhcmNoIiB9LA0KICAgICAgICAgIF0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsiZGVlcF90aGlua2luZyIsICJ3ZWJfc2VhcmNoIl0sDQogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwNCiAgICAgICAgICBzdGF0dXM6ICJpZGxlIiwNCiAgICAgICAgICBwcm9ncmVzc0xvZ3M6IFtdLA0KICAgICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsDQogICAgICAgIH0sDQogICAgICBdLA0KICAgICAgcHJvbXB0SW5wdXQ6ICIiLA0KICAgICAgdGFza1N0YXJ0ZWQ6IGZhbHNlLA0KICAgICAgYXV0b1BsYXk6IGZhbHNlLA0KICAgICAgc2NyZWVuc2hvdHM6IFtdLA0KICAgICAgcmVzdWx0czogW10sDQogICAgICBhY3RpdmVSZXN1bHRUYWI6ICJyZXN1bHQtMCIsDQogICAgICBhY3RpdmVDb2xsYXBzZXM6IFsiYWktc2VsZWN0aW9uIiwgInByb21wdC1pbnB1dCJdLCAvLyDpu5jorqTlsZXlvIDov5nkuKTkuKrljLrln58NCiAgICAgIHNob3dJbWFnZURpYWxvZzogZmFsc2UsDQogICAgICBjdXJyZW50TGFyZ2VJbWFnZTogIiIsDQogICAgICBlbmFibGVkQUlzOiBbXSwNCiAgICAgIHR1cm5kb3duU2VydmljZTogbmV3IFR1cm5kb3duU2VydmljZSh7DQogICAgICAgIGhlYWRpbmdTdHlsZTogImF0eCIsDQogICAgICAgIGNvZGVCbG9ja1N0eWxlOiAiZmVuY2VkIiwNCiAgICAgICAgZW1EZWxpbWl0ZXI6ICIqIiwNCiAgICAgIH0pLA0KICAgICAgc2NvcmVEaWFsb2dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIHNlbGVjdGVkUmVzdWx0czogW10sDQogICAgICBzY29yZVByb21wdDogYOivt+S9oOa3seW6pumYheivu+S7peS4i+WHoOevh+WGheWuue+8jOS7juWkmuS4que7tOW6pui/m+ihjOmAkOmhueaJk+WIhu+8jOi+k+WHuuivhOWIhue7k+aenOOAguW5tuWcqOS7peS4i+WQhOevh+aWh+eroOeahOWfuuehgOS4iuWNmumHh+S8l+mVv++8jOe7vOWQiOaVtOeQhuS4gOevh+abtOWFqOmdoueahOaWh+eroOOAgmAsDQogICAgICBsYXlvdXREaWFsb2dWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGxheW91dFByb21wdDogIiIsDQogICAgICBjdXJyZW50TGF5b3V0UmVzdWx0OiBudWxsLCAvLyDlvZPliY3opoHmjpLniYjnmoTnu5PmnpwNCiAgICAgIGhpc3RvcnlEcmF3ZXJWaXNpYmxlOiBmYWxzZSwNCiAgICAgIGNoYXRIaXN0b3J5OiBbXSwNCiAgICAgIHB1c2hPZmZpY2VOdW06IDAsIC8vIOaKlemAkuWIsOWFrOS8l+WPt+eahOmAkuWinue8luWPtw0KICAgICAgcHVzaGluZ1RvV2VjaGF0OiBmYWxzZSwgLy8g5oqV6YCS5Yiw5YWs5LyX5Y+355qEbG9hZGluZ+eKtuaAgQ0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgY2FuU2VuZCgpIHsNCiAgICAgIHJldHVybiAoDQogICAgICAgIHRoaXMucHJvbXB0SW5wdXQudHJpbSgpLmxlbmd0aCA+IDAgJiYNCiAgICAgICAgdGhpcy5haUxpc3Quc29tZSgoYWkpID0+IGFpLmVuYWJsZWQpDQogICAgICApOw0KICAgIH0sDQogICAgY2FuU2NvcmUoKSB7DQogICAgICByZXR1cm4gKA0KICAgICAgICB0aGlzLnNlbGVjdGVkUmVzdWx0cy5sZW5ndGggPiAwICYmIHRoaXMuc2NvcmVQcm9tcHQudHJpbSgpLmxlbmd0aCA+IDANCiAgICAgICk7DQogICAgfSwNCiAgICBjYW5MYXlvdXQoKSB7DQogICAgICByZXR1cm4gdGhpcy5sYXlvdXRQcm9tcHQudHJpbSgpLmxlbmd0aCA+IDA7DQogICAgfSwNCiAgICBncm91cGVkSGlzdG9yeSgpIHsNCiAgICAgIGNvbnN0IGdyb3VwcyA9IHt9Ow0KICAgICAgY29uc3QgY2hhdEdyb3VwcyA9IHt9Ow0KDQogICAgICAvLyDpppblhYjmjIljaGF0SWTliIbnu4QNCiAgICAgIHRoaXMuY2hhdEhpc3RvcnkuZm9yRWFjaCgoaXRlbSkgPT4gew0KICAgICAgICBpZiAoIWNoYXRHcm91cHNbaXRlbS5jaGF0SWRdKSB7DQogICAgICAgICAgY2hhdEdyb3Vwc1tpdGVtLmNoYXRJZF0gPSBbXTsNCiAgICAgICAgfQ0KICAgICAgICBjaGF0R3JvdXBzW2l0ZW0uY2hhdElkXS5wdXNoKGl0ZW0pOw0KICAgICAgfSk7DQoNCiAgICAgIC8vIOeEtuWQjuaMieaXpeacn+WIhue7hO+8jOW5tuWkhOeQhueItuWtkOWFs+ezuw0KICAgICAgT2JqZWN0LnZhbHVlcyhjaGF0R3JvdXBzKS5mb3JFYWNoKChjaGF0R3JvdXApID0+IHsNCiAgICAgICAgLy8g5oyJ5pe26Ze05o6S5bqPDQogICAgICAgIGNoYXRHcm91cC5zb3J0KA0KICAgICAgICAgIChhLCBiKSA9PiBuZXcgRGF0ZShhLmNyZWF0ZVRpbWUpIC0gbmV3IERhdGUoYi5jcmVhdGVUaW1lKQ0KICAgICAgICApOw0KDQogICAgICAgIC8vIOiOt+WPluacgOaXqeeahOiusOW9leS9nOS4uueItue6pw0KICAgICAgICBjb25zdCBwYXJlbnRJdGVtID0gY2hhdEdyb3VwWzBdOw0KICAgICAgICBjb25zdCBkYXRlID0gdGhpcy5nZXRIaXN0b3J5RGF0ZShwYXJlbnRJdGVtLmNyZWF0ZVRpbWUpOw0KDQogICAgICAgIGlmICghZ3JvdXBzW2RhdGVdKSB7DQogICAgICAgICAgZ3JvdXBzW2RhdGVdID0gW107DQogICAgICAgIH0NCg0KICAgICAgICAvLyDmt7vliqDniLbnuqforrDlvZUNCiAgICAgICAgZ3JvdXBzW2RhdGVdLnB1c2goew0KICAgICAgICAgIC4uLnBhcmVudEl0ZW0sDQogICAgICAgICAgaXNQYXJlbnQ6IHRydWUsDQogICAgICAgICAgaXNFeHBhbmRlZDogdGhpcy5leHBhbmRlZEhpc3RvcnlJdGVtc1twYXJlbnRJdGVtLmNoYXRJZF0gfHwgZmFsc2UsDQogICAgICAgICAgY2hpbGRyZW46IGNoYXRHcm91cC5zbGljZSgxKS5tYXAoKGNoaWxkKSA9PiAoew0KICAgICAgICAgICAgLi4uY2hpbGQsDQogICAgICAgICAgICBpc1BhcmVudDogZmFsc2UsDQogICAgICAgICAgfSkpLA0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KDQogICAgICByZXR1cm4gZ3JvdXBzOw0KICAgIH0sDQogIH0sDQogIGNyZWF0ZWQoKSB7DQogICAgY29uc29sZS5sb2codGhpcy51c2VySWQpOw0KICAgIGNvbnNvbGUubG9nKHRoaXMuY29ycElkKTsNCiAgICB0aGlzLmluaXRXZWJTb2NrZXQodGhpcy51c2VySWQpOw0KICAgIHRoaXMubG9hZENoYXRIaXN0b3J5KDApOyAvLyDliqDovb3ljoblj7LorrDlvZUNCiAgICB0aGlzLmxvYWRMYXN0Q2hhdCgpOyAvLyDliqDovb3kuIrmrKHkvJror50NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIHNlbmRQcm9tcHQoKSB7DQogICAgICBpZiAoIXRoaXMuY2FuU2VuZCkgcmV0dXJuOw0KDQogICAgICB0aGlzLnNjcmVlbnNob3RzID0gW107DQogICAgICAvLyDmipjlj6DmiYDmnInljLrln58NCiAgICAgIHRoaXMuYWN0aXZlQ29sbGFwc2VzID0gW107DQoNCiAgICAgIHRoaXMudGFza1N0YXJ0ZWQgPSB0cnVlOw0KICAgICAgdGhpcy5yZXN1bHRzID0gW107IC8vIOa4heepuuS5i+WJjeeahOe7k+aenA0KDQogICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gIiI7DQoNCiAgICAgIHRoaXMudXNlckluZm9SZXEudGFza0lkID0gdXVpZHY0KCk7DQogICAgICB0aGlzLnVzZXJJbmZvUmVxLnVzZXJJZCA9IHRoaXMudXNlcklkOw0KICAgICAgdGhpcy51c2VySW5mb1JlcS5jb3JwSWQgPSB0aGlzLmNvcnBJZDsNCiAgICAgIHRoaXMudXNlckluZm9SZXEudXNlclByb21wdCA9IHRoaXMucHJvbXB0SW5wdXQ7DQoNCiAgICAgIC8vIOiOt+WPluWQr+eUqOeahEFJ5YiX6KGo5Y+K5YW254q25oCBDQogICAgICB0aGlzLmVuYWJsZWRBSXMgPSB0aGlzLmFpTGlzdC5maWx0ZXIoKGFpKSA9PiBhaS5lbmFibGVkKTsNCg0KICAgICAgLy8g5bCG5omA5pyJ5ZCv55So55qEQUnnirbmgIHorr7nva7kuLrov5DooYzkuK0NCiAgICAgIHRoaXMuZW5hYmxlZEFJcy5mb3JFYWNoKChhaSkgPT4gew0KICAgICAgICB0aGlzLiRzZXQoYWksICJzdGF0dXMiLCAicnVubmluZyIpOw0KICAgICAgfSk7DQoNCiAgICAgIHRoaXMuZW5hYmxlZEFJcy5mb3JFYWNoKGFpID0+IHsNCiAgICAgICAgaWYoYWkubmFtZSA9PT0gJ0RlZXBTZWVrJyAmJiBhaS5lbmFibGVkKXsNCiAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICdkZWVwc2VlaywnOw0KICAgICAgICAgIGlmIChhaS5zZWxlY3RlZENhcGFiaWxpdGllcy5pbmNsdWRlcygiZGVlcF90aGlua2luZyIpKSB7DQogICAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICJkcy1zZHNrLCI7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChhaS5zZWxlY3RlZENhcGFiaWxpdGllcy5pbmNsdWRlcygid2ViX3NlYXJjaCIpKSB7DQogICAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICJkcy1sd3NzLCI7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmKGFpLm5hbWUgPT09ICfnn6XkuY7nm7TnrZQnKXsNCiAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICd6aGlodSwnOw0KICAgICAgICAgIGlmKGFpLnNlbGVjdGVkQ2FwYWJpbGl0aWVzLmluY2x1ZGVzKCJkZWVwX3RoaW5raW5nIikpew0KICAgICAgICAgICAgdGhpcy51c2VySW5mb1JlcS5yb2xlcyA9IHRoaXMudXNlckluZm9SZXEucm9sZXMgKyAnemhpaHUtc2RzaywnOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoYWkubmFtZSA9PT0gIuixhuWMhSIpIHsNCiAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICJ6ai1kYiwiOw0KICAgICAgICAgIGlmIChhaS5zZWxlY3RlZENhcGFiaWxpdGllcy5pbmNsdWRlcygiZGVlcF90aGlua2luZyIpKSB7DQogICAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICJ6ai1kYi1zZHNrLCI7DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGlmIChhaS5uYW1lID09PSAiTWluaU1heCBDaGF0Iikgew0KICAgICAgICAgIHRoaXMudXNlckluZm9SZXEucm9sZXMgPSB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzICsgIm1pbmktbWF4LWFnZW50LCI7DQogICAgICAgICAgaWYgKGFpLnNlbGVjdGVkQ2FwYWJpbGl0aWVzLmluY2x1ZGVzKCJkZWVwX3RoaW5raW5nIikpIHsNCiAgICAgICAgICAgIHRoaXMudXNlckluZm9SZXEucm9sZXMgPSB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzICsgIm1heC1zZHNrLCI7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChhaS5zZWxlY3RlZENhcGFiaWxpdGllcy5pbmNsdWRlcygid2ViX3NlYXJjaCIpKSB7DQogICAgICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnJvbGVzID0gdGhpcy51c2VySW5mb1JlcS5yb2xlcyArICJtYXgtbHdzcywiOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSk7DQoNCiAgICAgIGNvbnNvbGUubG9nKCLlj4LmlbDvvJoiLCB0aGlzLnVzZXJJbmZvUmVxKTsNCg0KICAgICAgLy/osIPnlKjlkI7nq6/mjqXlj6MNCiAgICAgIHRoaXMuanNvblJwY1JlcWVzdC5tZXRob2QgPSAi5L2/55SoRjhTIjsNCiAgICAgIHRoaXMuanNvblJwY1JlcWVzdC5wYXJhbXMgPSB0aGlzLnVzZXJJbmZvUmVxOw0KICAgICAgdGhpcy5tZXNzYWdlKHRoaXMuanNvblJwY1JlcWVzdCk7DQogICAgICB0aGlzLnVzZXJJbmZvUmVxLmlzTmV3Q2hhdCA9IGZhbHNlOw0KICAgIH0sDQoNCiAgICBtZXNzYWdlKGRhdGEpIHsNCiAgICAgIG1lc3NhZ2UoZGF0YSkudGhlbigocmVzKSA9PiB7DQogICAgICAgIGlmIChyZXMuY29kZSA9PSAyMDEpIHsNCiAgICAgICAgICB1bmkuc2hvd1RvYXN0KHsNCiAgICAgICAgICAgIHRpdGxlOiByZXMubWVzc2FnZXMsDQogICAgICAgICAgICBpY29uOiAibm9uZSIsDQogICAgICAgICAgICBkdXJhdGlvbjogMTUwMCwNCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCiAgICB0b2dnbGVDYXBhYmlsaXR5KGFpLCBjYXBhYmlsaXR5VmFsdWUpIHsNCiAgICAgIGlmICghYWkuZW5hYmxlZCkgcmV0dXJuOw0KDQogICAgICBjb25zdCBpbmRleCA9IGFpLnNlbGVjdGVkQ2FwYWJpbGl0aWVzLmluZGV4T2YoY2FwYWJpbGl0eVZhbHVlKTsNCiAgICAgIGNvbnNvbGUubG9nKCLliIfmjaLliY06IiwgYWkuc2VsZWN0ZWRDYXBhYmlsaXRpZXMpOw0KICAgICAgaWYgKGluZGV4ID09PSAtMSkgew0KICAgICAgICAvLyDlpoLmnpzkuI3lrZjlnKjvvIzliJnmt7vliqANCiAgICAgICAgdGhpcy4kc2V0KA0KICAgICAgICAgIGFpLnNlbGVjdGVkQ2FwYWJpbGl0aWVzLA0KICAgICAgICAgIGFpLnNlbGVjdGVkQ2FwYWJpbGl0aWVzLmxlbmd0aCwNCiAgICAgICAgICBjYXBhYmlsaXR5VmFsdWUNCiAgICAgICAgKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIOWmguaenOW3suWtmOWcqO+8jOWImeenu+mZpA0KICAgICAgICBjb25zdCBuZXdDYXBhYmlsaXRpZXMgPSBbLi4uYWkuc2VsZWN0ZWRDYXBhYmlsaXRpZXNdOw0KICAgICAgICBuZXdDYXBhYmlsaXRpZXMuc3BsaWNlKGluZGV4LCAxKTsNCiAgICAgICAgdGhpcy4kc2V0KGFpLCAic2VsZWN0ZWRDYXBhYmlsaXRpZXMiLCBuZXdDYXBhYmlsaXRpZXMpOw0KICAgICAgfQ0KICAgICAgY29uc29sZS5sb2coIuWIh+aNouWQjjoiLCBhaS5zZWxlY3RlZENhcGFiaWxpdGllcyk7DQogICAgICB0aGlzLiRmb3JjZVVwZGF0ZSgpOyAvLyDlvLrliLbmm7TmlrDop4blm74NCiAgICB9LA0KICAgIGdldFN0YXR1c1RleHQoc3RhdHVzKSB7DQogICAgICBzd2l0Y2ggKHN0YXR1cykgew0KICAgICAgICBjYXNlICJpZGxlIjoNCiAgICAgICAgICByZXR1cm4gIuetieW+heS4rSI7DQogICAgICAgIGNhc2UgInJ1bm5pbmciOg0KICAgICAgICAgIHJldHVybiAi5q2j5Zyo5omn6KGMIjsNCiAgICAgICAgY2FzZSAiY29tcGxldGVkIjoNCiAgICAgICAgICByZXR1cm4gIuW3suWujOaIkCI7DQogICAgICAgIGNhc2UgImZhaWxlZCI6DQogICAgICAgICAgcmV0dXJuICLmiafooYzlpLHotKUiOw0KICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgIHJldHVybiAi5pyq55+l54q25oCBIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIGdldFN0YXR1c0ljb24oc3RhdHVzKSB7DQogICAgICBzd2l0Y2ggKHN0YXR1cykgew0KICAgICAgICBjYXNlICJpZGxlIjoNCiAgICAgICAgICByZXR1cm4gImVsLWljb24tdGltZSI7DQogICAgICAgIGNhc2UgInJ1bm5pbmciOg0KICAgICAgICAgIHJldHVybiAiZWwtaWNvbi1sb2FkaW5nIjsNCiAgICAgICAgY2FzZSAiY29tcGxldGVkIjoNCiAgICAgICAgICByZXR1cm4gImVsLWljb24tY2hlY2sgc3VjY2Vzcy1pY29uIjsNCiAgICAgICAgY2FzZSAiZmFpbGVkIjoNCiAgICAgICAgICByZXR1cm4gImVsLWljb24tY2xvc2UgZXJyb3ItaWNvbiI7DQogICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgcmV0dXJuICJlbC1pY29uLXF1ZXN0aW9uIjsNCiAgICAgIH0NCiAgICB9LA0KICAgIHJlbmRlck1hcmtkb3duKHRleHQpIHsNCiAgICAgIHJldHVybiBtYXJrZWQodGV4dCk7DQogICAgfSwNCiAgICAvLyBIVE1M6L2s57qv5paH5pysDQogICAgaHRtbFRvVGV4dChodG1sKSB7DQogICAgICBjb25zdCB0ZW1wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7DQogICAgICB0ZW1wRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgICByZXR1cm4gdGVtcERpdi50ZXh0Q29udGVudCB8fCB0ZW1wRGl2LmlubmVyVGV4dCB8fCAiIjsNCiAgICB9LA0KDQogICAgLy8gSFRNTOi9rE1hcmtkb3duDQogICAgaHRtbFRvTWFya2Rvd24oaHRtbCkgew0KICAgICAgcmV0dXJuIHRoaXMudHVybmRvd25TZXJ2aWNlLnR1cm5kb3duKGh0bWwpOw0KICAgIH0sDQoNCiAgICBjb3B5UmVzdWx0KGNvbnRlbnQpIHsNCiAgICAgIC8vIOWwhkhUTUzovazmjaLkuLrnuq/mlofmnKwNCiAgICAgIGNvbnN0IHBsYWluVGV4dCA9IHRoaXMuaHRtbFRvVGV4dChjb250ZW50KTsNCiAgICAgIGNvbnN0IHRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKTsNCiAgICAgIHRleHRhcmVhLnZhbHVlID0gcGxhaW5UZXh0Ow0KICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZXh0YXJlYSk7DQogICAgICB0ZXh0YXJlYS5zZWxlY3QoKTsNCiAgICAgIGRvY3VtZW50LmV4ZWNDb21tYW5kKCJjb3B5Iik7DQogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRleHRhcmVhKTsNCiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5bey5aSN5Yi257qv5paH5pys5Yiw5Ymq6LS05p2/Iik7DQogICAgfSwNCg0KICAgIGV4cG9ydFJlc3VsdChyZXN1bHQpIHsNCiAgICAgIC8vIOWwhkhUTUzovazmjaLkuLpNYXJrZG93bg0KICAgICAgY29uc3QgbWFya2Rvd24gPSByZXN1bHQuY29udGVudDsNCiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbbWFya2Rvd25dLCB7IHR5cGU6ICJ0ZXh0L21hcmtkb3duIiB9KTsNCiAgICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7DQogICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOw0KICAgICAgbGluay5kb3dubG9hZCA9IGAke3Jlc3VsdC5haU5hbWV9X+e7k+aenF8ke25ldyBEYXRlKCkNCiAgICAgICAgLnRvSVNPU3RyaW5nKCkNCiAgICAgICAgLnNsaWNlKDAsIDEwKX0ubWRgOw0KICAgICAgbGluay5jbGljaygpOw0KICAgICAgVVJMLnJldm9rZU9iamVjdFVSTChsaW5rLmhyZWYpOw0KICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLlt7Llr7zlh7pNYXJrZG93buaWh+S7tiIpOw0KICAgIH0sDQoNCiAgICBvcGVuU2hhcmVVcmwoc2hhcmVVcmwpIHsNCiAgICAgIGlmIChzaGFyZVVybCkgew0KICAgICAgICB3aW5kb3cub3BlbihzaGFyZVVybCwgIl9ibGFuayIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS53YXJuaW5nKCLmmoLml6Dljp/pk77mjqUiKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIHNob3dMYXJnZUltYWdlKGltYWdlVXJsKSB7DQogICAgICB0aGlzLmN1cnJlbnRMYXJnZUltYWdlID0gaW1hZ2VVcmw7DQogICAgICB0aGlzLnNob3dJbWFnZURpYWxvZyA9IHRydWU7DQogICAgICAvLyDmib7liLDlvZPliY3lm77niYfnmoTntKLlvJXvvIzorr7nva7ova7mkq3lm77nmoTliJ3lp4vkvY3nva4NCiAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IHRoaXMuc2NyZWVuc2hvdHMuaW5kZXhPZihpbWFnZVVybCk7DQogICAgICBpZiAoY3VycmVudEluZGV4ICE9PSAtMSkgew0KICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgICAgY29uc3QgY2Fyb3VzZWwgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCIuaW1hZ2UtZGlhbG9nIC5lbC1jYXJvdXNlbCIpOw0KICAgICAgICAgIGlmIChjYXJvdXNlbCAmJiBjYXJvdXNlbC5fX3Z1ZV9fKSB7DQogICAgICAgICAgICBjYXJvdXNlbC5fX3Z1ZV9fLnNldEFjdGl2ZUl0ZW0oY3VycmVudEluZGV4KTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgICAgfQ0KICAgIH0sDQogICAgY2xvc2VMYXJnZUltYWdlKCkgew0KICAgICAgdGhpcy5zaG93SW1hZ2VEaWFsb2cgPSBmYWxzZTsNCiAgICAgIHRoaXMuY3VycmVudExhcmdlSW1hZ2UgPSAiIjsNCiAgICB9LA0KICAgIC8vIFdlYlNvY2tldCDnm7jlhbPmlrnms5UNCiAgICBpbml0V2ViU29ja2V0KGlkKSB7DQogICAgICBjb25zdCB3c1VybCA9IHByb2Nlc3MuZW52LlZVRV9BUFBfV1NfQVBJICsgYG15cGMtJHtpZH1gOw0KICAgICAgY29uc29sZS5sb2coIldlYlNvY2tldCBVUkw6IiwgcHJvY2Vzcy5lbnYuVlVFX0FQUF9XU19BUEkpOw0KICAgICAgd2Vic29ja2V0Q2xpZW50LmNvbm5lY3Qod3NVcmwsIChldmVudCkgPT4gew0KICAgICAgICBzd2l0Y2ggKGV2ZW50LnR5cGUpIHsNCiAgICAgICAgICBjYXNlICJvcGVuIjoNCiAgICAgICAgICAgIC8vIHRoaXMuJG1lc3NhZ2Uuc3VjY2VzcygnJyk7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICJtZXNzYWdlIjoNCiAgICAgICAgICAgIHRoaXMuaGFuZGxlV2ViU29ja2V0TWVzc2FnZShldmVudC5kYXRhKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgImNsb3NlIjoNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uud2FybmluZygiV2ViU29ja2V06L+e5o6l5bey5YWz6ZetIik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICJlcnJvciI6DQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCJXZWJTb2NrZXTov57mjqXplJnor68iKTsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgInJlY29ubmVjdF9mYWlsZWQiOg0KICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigiV2ViU29ja2V06YeN6L+e5aSx6LSl77yM6K+35Yi35paw6aG16Z2i6YeN6K+VIik7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIGhhbmRsZVdlYlNvY2tldE1lc3NhZ2UoZGF0YSkgew0KICAgICAgY29uc3QgZGF0YXN0ciA9IGRhdGE7DQogICAgICBjb25zdCBkYXRhT2JqID0gSlNPTi5wYXJzZShkYXRhc3RyKTsNCg0KICAgICAgLy8g5aSE55CGY2hhdElk5raI5oGvDQogICAgICBpZiAoZGF0YU9iai50eXBlID09PSAiUkVUVVJOX1lCVDFfQ0hBVElEIiAmJiBkYXRhT2JqLmNoYXRJZCkgew0KICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnRvbmVDaGF0SWQgPSBkYXRhT2JqLmNoYXRJZDsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YU9iai50eXBlID09PSAiUkVUVVJOX1lCRFNfQ0hBVElEIiAmJiBkYXRhT2JqLmNoYXRJZCkgew0KICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLnliRHNDaGF0SWQgPSBkYXRhT2JqLmNoYXRJZDsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YU9iai50eXBlID09PSAiUkVUVVJOX0RCX0NIQVRJRCIgJiYgZGF0YU9iai5jaGF0SWQpIHsNCiAgICAgICAgdGhpcy51c2VySW5mb1JlcS5kYkNoYXRJZCA9IGRhdGFPYmouY2hhdElkOw0KICAgICAgfSBlbHNlIGlmIChkYXRhT2JqLnR5cGUgPT09ICJSRVRVUk5fTUFYX0NIQVRJRCIgJiYgZGF0YU9iai5jaGF0SWQpIHsNCiAgICAgICAgdGhpcy51c2VySW5mb1JlcS5tYXhDaGF0SWQgPSBkYXRhT2JqLmNoYXRJZDsNCiAgICAgIH0gZWxzZSBpZiAoZGF0YU9iai50eXBlID09PSAnUkVUVVJOX1pIX0NIQVRJRCcgJiYgZGF0YU9iai5jaGF0SWQpIHsNCiAgICAgICAgdGhpcy51c2VySW5mb1JlcS56aENoYXRJZCA9IGRhdGFPYmouY2hhdElkOw0KICAgICAgfQ0KDQogICAgICAvLyDlpITnkIbov5vluqbml6Xlv5fmtojmga8NCiAgICAgIGlmIChkYXRhT2JqLnR5cGUgPT09ICJSRVRVUk5fUENfVEFTS19MT0ciICYmIGRhdGFPYmouYWlOYW1lKSB7DQogICAgICAgIGNvbnN0IHRhcmdldEFJID0gdGhpcy5lbmFibGVkQUlzLmZpbmQoDQogICAgICAgICAgKGFpKSA9PiBhaS5uYW1lID09PSBkYXRhT2JqLmFpTmFtZQ0KICAgICAgICApOw0KICAgICAgICBpZiAodGFyZ2V0QUkpIHsNCiAgICAgICAgICAvLyDlsIbmlrDov5vluqbmt7vliqDliLDmlbDnu4TlvIDlpLQNCiAgICAgICAgICB0YXJnZXRBSS5wcm9ncmVzc0xvZ3MudW5zaGlmdCh7DQogICAgICAgICAgICBjb250ZW50OiBkYXRhT2JqLmNvbnRlbnQsDQogICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksDQogICAgICAgICAgICBpc0NvbXBsZXRlZDogZmFsc2UsDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KDQogICAgICAvLyDlpITnkIbmiKrlm77mtojmga8NCiAgICAgIGlmIChkYXRhT2JqLnR5cGUgPT09ICJSRVRVUk5fUENfVEFTS19JTUciICYmIGRhdGFPYmoudXJsKSB7DQogICAgICAgIC8vIOWwhuaWsOeahOaIquWbvua3u+WKoOWIsOaVsOe7hOW8gOWktA0KICAgICAgICB0aGlzLnNjcmVlbnNob3RzLnVuc2hpZnQoZGF0YU9iai51cmwpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQoNCiAgICAgIC8vIOWkhOeQhuaZuuiDveivhOWIhue7k+aenA0KICAgICAgaWYgKGRhdGFPYmoudHlwZSA9PT0gIlJFVFVSTl9XS1BGX1JFUyIpIHsNCiAgICAgICAgY29uc3Qgd2twZkFJID0gdGhpcy5lbmFibGVkQUlzLmZpbmQoKGFpKSA9PiBhaS5uYW1lID09PSAi5pm66IO96K+E5YiGIik7DQogICAgICAgIGlmICh3a3BmQUkpIHsNCiAgICAgICAgICB0aGlzLiRzZXQod2twZkFJLCAic3RhdHVzIiwgImNvbXBsZXRlZCIpOw0KICAgICAgICAgIGlmICh3a3BmQUkucHJvZ3Jlc3NMb2dzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgIHRoaXMuJHNldCh3a3BmQUkucHJvZ3Jlc3NMb2dzWzBdLCAiaXNDb21wbGV0ZWQiLCB0cnVlKTsNCiAgICAgICAgICB9DQogICAgICAgICAgLy8g5re75Yqg6K+E5YiG57uT5p6c5YiwcmVzdWx0c+acgOWJjemdog0KICAgICAgICAgIHRoaXMucmVzdWx0cy51bnNoaWZ0KHsNCiAgICAgICAgICAgIGFpTmFtZTogIuaZuuiDveivhOWIhiIsDQogICAgICAgICAgICBjb250ZW50OiBkYXRhT2JqLmRyYWZ0Q29udGVudCwNCiAgICAgICAgICAgIHNoYXJlVXJsOiBkYXRhT2JqLnNoYXJlVXJsIHx8ICIiLA0KICAgICAgICAgICAgc2hhcmVJbWdVcmw6IGRhdGFPYmouc2hhcmVJbWdVcmwgfHwgIiIsDQogICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksDQogICAgICAgICAgfSk7DQogICAgICAgICAgdGhpcy5hY3RpdmVSZXN1bHRUYWIgPSAicmVzdWx0LTAiOw0KDQogICAgICAgICAgLy8g5pm66IO96K+E5YiG5a6M5oiQ5pe277yM5YaN5qyh5L+d5a2Y5Y6G5Y+y6K6w5b2VDQogICAgICAgICAgdGhpcy5zYXZlSGlzdG9yeSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgLy8g5aSE55CG5pm66IO95o6S54mI57uT5p6cDQogICAgICBpZiAoZGF0YU9iai50eXBlID09PSAiUkVUVVJOX1pOUEJfUkVTIikgew0KICAgICAgICBjb25zdCB6bnBiQUkgPSB0aGlzLmVuYWJsZWRBSXMuZmluZCgoYWkpID0+IGFpLm5hbWUgPT09ICLmmbrog73mjpLniYgiKTsNCiAgICAgICAgaWYgKHpucGJBSSkgew0KICAgICAgICAgIHRoaXMuJHNldCh6bnBiQUksICJzdGF0dXMiLCAiY29tcGxldGVkIik7DQogICAgICAgICAgaWYgKHpucGJBSS5wcm9ncmVzc0xvZ3MubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgdGhpcy4kc2V0KHpucGJBSS5wcm9ncmVzc0xvZ3NbMF0sICJpc0NvbXBsZXRlZCIsIHRydWUpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIOebtOaOpeiwg+eUqOaKlemAkuWIsOWFrOS8l+WPt+eahOaWueazle+8jOS4jea3u+WKoOWIsOe7k+aenOWxleekug0KICAgICAgICAgIHRoaXMucHVzaFRvV2VjaGF0V2l0aENvbnRlbnQoZGF0YU9iai5kcmFmdENvbnRlbnQpOw0KDQogICAgICAgICAgLy8g5pm66IO95o6S54mI5a6M5oiQ5pe277yM5L+d5a2Y5Y6G5Y+y6K6w5b2VDQogICAgICAgICAgdGhpcy5zYXZlSGlzdG9yeSgpOw0KICAgICAgICB9DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCg0KICAgICAgLy8g5qC55o2u5raI5oGv57G75Z6L5pu05paw5a+55bqUQUnnmoTnirbmgIHlkoznu5PmnpwNCiAgICAgIGxldCB0YXJnZXRBSSA9IG51bGw7DQogICAgICBzd2l0Y2ggKGRhdGFPYmoudHlwZSkgew0KICAgICAgICBjYXNlICdSRVRVUk5fWkhfUkVTJzoNCiAgICAgICAgICBjb25zb2xlLmxvZygn5pS25Yiw55+l5LmO55u0562U5raI5oGvOicsZGF0YSk7DQogICAgICAgICAgdGFyZ2V0QUkgPSB0aGlzLmVuYWJsZWRBSXMuZmluZChhaSA9PiBhaS5uYW1lID09PSAn55+l5LmO55u0562UJyk7DQogICAgICAgICAgYnJlYWs7DQogICAgICAgIGNhc2UgJ1JFVFVSTl9ZQlQxX1JFUyc6DQogICAgICAgIGNhc2UgJ1JFVFVSTl9UVVJCT1NfUkVTJzoNCiAgICAgICAgY2FzZSAnUkVUVVJOX1RVUkJPU19MQVJHRV9SRVMnOg0KICAgICAgICBjYXNlICdSRVRVUk5fREVFUFNFRUtfUkVTJzoNCiAgICAgICAgICBjb25zb2xlLmxvZygn5pS25YiwRGVlcFNlZWvmtojmga86JywgZGF0YU9iaik7DQogICAgICAgICAgdGFyZ2V0QUkgPSB0aGlzLmVuYWJsZWRBSXMuZmluZChhaSA9PiBhaS5uYW1lID09PSAnRGVlcFNlZWsnKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgICAgY2FzZSAiUkVUVVJOX0RCX1JFUyI6DQogICAgICAgICAgY29uc29sZS5sb2coIuaUtuWIsOixhuWMhea2iOaBrzoiLCBkYXRhT2JqKTsNCiAgICAgICAgICB0YXJnZXRBSSA9IHRoaXMuZW5hYmxlZEFJcy5maW5kKChhaSkgPT4gYWkubmFtZSA9PT0gIuixhuWMhSIpOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBjYXNlICJSRVRVUk5fTUFYX1JFUyI6DQogICAgICAgICAgY29uc29sZS5sb2coIuaUtuWIsE1pbmlNYXjmtojmga86IiwgZGF0YU9iaik7DQogICAgICAgICAgdGFyZ2V0QUkgPSB0aGlzLmVuYWJsZWRBSXMuZmluZCgoYWkpID0+IGFpLm5hbWUgPT09ICJNaW5pTWF4IENoYXQiKTsNCiAgICAgICAgICBicmVhazsNCiAgICAgIH0NCg0KICAgICAgaWYgKHRhcmdldEFJKSB7DQogICAgICAgIC8vIOabtOaWsEFJ54q25oCB5Li65bey5a6M5oiQDQogICAgICAgIHRoaXMuJHNldCh0YXJnZXRBSSwgInN0YXR1cyIsICJjb21wbGV0ZWQiKTsNCg0KICAgICAgICAvLyDlsIbmnIDlkI7kuIDmnaHov5vluqbmtojmga/moIforrDkuLrlt7LlrozmiJANCiAgICAgICAgaWYgKHRhcmdldEFJLnByb2dyZXNzTG9ncy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgdGhpcy4kc2V0KHRhcmdldEFJLnByb2dyZXNzTG9nc1swXSwgImlzQ29tcGxldGVkIiwgdHJ1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyDmt7vliqDnu5PmnpzliLDmlbDnu4TlvIDlpLQNCiAgICAgICAgY29uc3QgcmVzdWx0SW5kZXggPSB0aGlzLnJlc3VsdHMuZmluZEluZGV4KA0KICAgICAgICAgIChyKSA9PiByLmFpTmFtZSA9PT0gdGFyZ2V0QUkubmFtZQ0KICAgICAgICApOw0KICAgICAgICBpZiAocmVzdWx0SW5kZXggPT09IC0xKSB7DQogICAgICAgICAgdGhpcy5yZXN1bHRzLnVuc2hpZnQoew0KICAgICAgICAgICAgYWlOYW1lOiB0YXJnZXRBSS5uYW1lLA0KICAgICAgICAgICAgY29udGVudDogZGF0YU9iai5kcmFmdENvbnRlbnQsDQogICAgICAgICAgICBzaGFyZVVybDogZGF0YU9iai5zaGFyZVVybCB8fCAiIiwNCiAgICAgICAgICAgIHNoYXJlSW1nVXJsOiBkYXRhT2JqLnNoYXJlSW1nVXJsIHx8ICIiLA0KICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLA0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHRoaXMuYWN0aXZlUmVzdWx0VGFiID0gInJlc3VsdC0wIjsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB0aGlzLnJlc3VsdHMuc3BsaWNlKHJlc3VsdEluZGV4LCAxKTsNCiAgICAgICAgICB0aGlzLnJlc3VsdHMudW5zaGlmdCh7DQogICAgICAgICAgICBhaU5hbWU6IHRhcmdldEFJLm5hbWUsDQogICAgICAgICAgICBjb250ZW50OiBkYXRhT2JqLmRyYWZ0Q29udGVudCwNCiAgICAgICAgICAgIHNoYXJlVXJsOiBkYXRhT2JqLnNoYXJlVXJsIHx8ICIiLA0KICAgICAgICAgICAgc2hhcmVJbWdVcmw6IGRhdGFPYmouc2hhcmVJbWdVcmwgfHwgIiIsDQogICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksDQogICAgICAgICAgfSk7DQogICAgICAgICAgdGhpcy5hY3RpdmVSZXN1bHRUYWIgPSAicmVzdWx0LTAiOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuc2F2ZUhpc3RvcnkoKTsNCiAgICAgIH0NCg0KICAgICAgLy8g5qOA5p+l5piv5ZCm5omA5pyJ5Lu75Yqh6YO95bey5a6M5oiQDQogICAgICAvLyBjb25zdCBhbGxDb21wbGV0ZWQgPSB0aGlzLmVuYWJsZWRBSXMuZXZlcnkoYWkgPT4NCiAgICAgIC8vICAgYWkuc3RhdHVzID09PSAnY29tcGxldGVkJyB8fCBhaS5zdGF0dXMgPT09ICdmYWlsZWQnDQogICAgICAvLyApOw0KDQogICAgICAvLyBpZiAoYWxsQ29tcGxldGVkKSB7DQogICAgICAvLw0KICAgICAgLy8gfQ0KICAgIH0sDQoNCiAgICBjbG9zZVdlYlNvY2tldCgpIHsNCiAgICAgIHdlYnNvY2tldENsaWVudC5jbG9zZSgpOw0KICAgIH0sDQoNCiAgICBzZW5kTWVzc2FnZShkYXRhKSB7DQogICAgICBpZiAod2Vic29ja2V0Q2xpZW50LnNlbmQoZGF0YSkpIHsNCiAgICAgICAgLy8g5rua5Yqo5Yiw5bqV6YOoDQogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7DQogICAgICAgIH0pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigiV2ViU29ja2V05pyq6L+e5o6lIik7DQogICAgICB9DQogICAgfSwNCiAgICB0b2dnbGVBSUV4cGFuc2lvbihhaSkgew0KICAgICAgdGhpcy4kc2V0KGFpLCAiaXNFeHBhbmRlZCIsICFhaS5pc0V4cGFuZGVkKTsNCiAgICB9LA0KDQogICAgZm9ybWF0VGltZSh0aW1lc3RhbXApIHsNCiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZSh0aW1lc3RhbXApOw0KICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVUaW1lU3RyaW5nKCJ6aC1DTiIsIHsNCiAgICAgICAgaG91cjogIjItZGlnaXQiLA0KICAgICAgICBtaW51dGU6ICIyLWRpZ2l0IiwNCiAgICAgICAgc2Vjb25kOiAiMi1kaWdpdCIsDQogICAgICAgIGhvdXIxMjogZmFsc2UsDQogICAgICB9KTsNCiAgICB9LA0KICAgIHNob3dTY29yZURpYWxvZygpIHsNCiAgICAgIHRoaXMuc2NvcmVEaWFsb2dWaXNpYmxlID0gdHJ1ZTsNCiAgICAgIHRoaXMuc2VsZWN0ZWRSZXN1bHRzID0gW107DQogICAgfSwNCg0KICAgIGhhbmRsZVNjb3JlKCkgew0KICAgICAgaWYgKCF0aGlzLmNhblNjb3JlKSByZXR1cm47DQoNCiAgICAgIC8vIOiOt+WPlumAieS4reeahOe7k+aenOWGheWuueW5tuaMieeFp+aMh+WumuagvOW8j+aLvOaOpQ0KICAgICAgY29uc3Qgc2VsZWN0ZWRDb250ZW50cyA9IHRoaXMucmVzdWx0cw0KICAgICAgICAuZmlsdGVyKChyZXN1bHQpID0+IHRoaXMuc2VsZWN0ZWRSZXN1bHRzLmluY2x1ZGVzKHJlc3VsdC5haU5hbWUpKQ0KICAgICAgICAubWFwKChyZXN1bHQpID0+IHsNCiAgICAgICAgICAvLyDlsIZIVE1M5YaF5a656L2s5o2i5Li657qv5paH5pysDQogICAgICAgICAgY29uc3QgcGxhaW5Db250ZW50ID0gdGhpcy5odG1sVG9UZXh0KHJlc3VsdC5jb250ZW50KTsNCiAgICAgICAgICByZXR1cm4gYCR7cmVzdWx0LmFpTmFtZX3liJ3nqL/vvJpcbiR7cGxhaW5Db250ZW50fVxuYDsNCiAgICAgICAgfSkNCiAgICAgICAgLmpvaW4oIlxuIik7DQoNCiAgICAgIC8vIOaehOW7uuWujOaVtOeahOivhOWIhuaPkOekuuWGheWuuQ0KICAgICAgY29uc3QgZnVsbFByb21wdCA9IGAke3RoaXMuc2NvcmVQcm9tcHR9XG4ke3NlbGVjdGVkQ29udGVudHN9YDsNCg0KICAgICAgLy8g5p6E5bu66K+E5YiG6K+35rGCDQogICAgICBjb25zdCBzY29yZVJlcXVlc3QgPSB7DQogICAgICAgIGpzb25ycGM6ICIyLjAiLA0KICAgICAgICBpZDogdXVpZHY0KCksDQogICAgICAgIG1ldGhvZDogIkFJ6K+E5YiGIiwNCiAgICAgICAgcGFyYW1zOiB7DQogICAgICAgICAgdGFza0lkOiB1dWlkdjQoKSwNCiAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLA0KICAgICAgICAgIGNvcnBJZDogdGhpcy5jb3JwSWQsDQogICAgICAgICAgdXNlclByb21wdDogZnVsbFByb21wdCwNCiAgICAgICAgICByb2xlczogInpqLWRiLXNkc2siLCAvLyDpu5jorqTkvb/nlKjosYbljIXov5vooYzor4TliIYNCiAgICAgICAgfSwNCiAgICAgIH07DQoNCiAgICAgIC8vIOWPkemAgeivhOWIhuivt+axgg0KICAgICAgY29uc29sZS5sb2coIuWPguaVsCIsIHNjb3JlUmVxdWVzdCk7DQogICAgICB0aGlzLm1lc3NhZ2Uoc2NvcmVSZXF1ZXN0KTsNCiAgICAgIHRoaXMuc2NvcmVEaWFsb2dWaXNpYmxlID0gZmFsc2U7DQoNCiAgICAgIC8vIOWIm+W7uuaZuuiDveivhOWIhkFJ6IqC54K5DQogICAgICBjb25zdCB3a3BmQUkgPSB7DQogICAgICAgIG5hbWU6ICLmmbrog73or4TliIYiLA0KICAgICAgICBhdmF0YXI6IHJlcXVpcmUoIi4uLy4uLy4uL2Fzc2V0cy9haS95dWFuYmFvLnBuZyIpLA0KICAgICAgICBjYXBhYmlsaXRpZXM6IFtdLA0KICAgICAgICBzZWxlY3RlZENhcGFiaWxpdGllczogW10sDQogICAgICAgIGVuYWJsZWQ6IHRydWUsDQogICAgICAgIHN0YXR1czogInJ1bm5pbmciLA0KICAgICAgICBwcm9ncmVzc0xvZ3M6IFsNCiAgICAgICAgICB7DQogICAgICAgICAgICBjb250ZW50OiAi5pm66IO96K+E5YiG5Lu75Yqh5bey5o+Q5Lqk77yM5q2j5Zyo6K+E5YiGLi4uIiwNCiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSwNCiAgICAgICAgICAgIGlzQ29tcGxldGVkOiBmYWxzZSwNCiAgICAgICAgICAgIHR5cGU6ICLmmbrog73or4TliIYiLA0KICAgICAgICAgIH0sDQogICAgICAgIF0sDQogICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsDQogICAgICB9Ow0KDQogICAgICAvLyDmo4Dmn6XmmK/lkKblt7LlrZjlnKjmmbrog73or4TliIYNCiAgICAgIGNvbnN0IGV4aXN0SW5kZXggPSB0aGlzLmVuYWJsZWRBSXMuZmluZEluZGV4KA0KICAgICAgICAoYWkpID0+IGFpLm5hbWUgPT09ICLmmbrog73or4TliIYiDQogICAgICApOw0KICAgICAgaWYgKGV4aXN0SW5kZXggPT09IC0xKSB7DQogICAgICAgIC8vIOWmguaenOS4jeWtmOWcqO+8jOa3u+WKoOWIsOaVsOe7hOW8gOWktA0KICAgICAgICB0aGlzLmVuYWJsZWRBSXMudW5zaGlmdCh3a3BmQUkpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8g5aaC5p6c5bey5a2Y5Zyo77yM5pu05paw54q25oCB5ZKM5pel5b+XDQogICAgICAgIHRoaXMuZW5hYmxlZEFJc1tleGlzdEluZGV4XSA9IHdrcGZBSTsNCiAgICAgICAgLy8g5bCG5pm66IO96K+E5YiG56e75Yiw5pWw57uE5byA5aS0DQogICAgICAgIGNvbnN0IHdrcGYgPSB0aGlzLmVuYWJsZWRBSXMuc3BsaWNlKGV4aXN0SW5kZXgsIDEpWzBdOw0KICAgICAgICB0aGlzLmVuYWJsZWRBSXMudW5zaGlmdCh3a3BmKTsNCiAgICAgIH0NCg0KICAgICAgdGhpcy4kZm9yY2VVcGRhdGUoKTsNCiAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi6K+E5YiG6K+35rGC5bey5Y+R6YCB77yM6K+3562J5b6F57uT5p6cIik7DQogICAgfSwNCiAgICAvLyDmmL7npLrljoblj7LorrDlvZXmir3lsYkNCiAgICBzaG93SGlzdG9yeURyYXdlcigpIHsNCiAgICAgIHRoaXMuaGlzdG9yeURyYXdlclZpc2libGUgPSB0cnVlOw0KICAgICAgdGhpcy5sb2FkQ2hhdEhpc3RvcnkoMSk7DQogICAgfSwNCg0KICAgIC8vIOWFs+mXreWOhuWPsuiusOW9leaKveWxiQ0KICAgIGhhbmRsZUhpc3RvcnlEcmF3ZXJDbG9zZSgpIHsNCiAgICAgIHRoaXMuaGlzdG9yeURyYXdlclZpc2libGUgPSBmYWxzZTsNCiAgICB9LA0KDQogICAgLy8g5Yqg6L295Y6G5Y+y6K6w5b2VDQogICAgYXN5bmMgbG9hZENoYXRIaXN0b3J5KGlzQWxsKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRDaGF0SGlzdG9yeSh0aGlzLnVzZXJJZCwgaXNBbGwpOw0KICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCkgew0KICAgICAgICAgIHRoaXMuY2hhdEhpc3RvcnkgPSByZXMuZGF0YSB8fCBbXTsNCiAgICAgICAgfQ0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigi5Yqg6L295Y6G5Y+y6K6w5b2V5aSx6LSlOiIsIGVycm9yKTsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5Yqg6L295Y6G5Y+y6K6w5b2V5aSx6LSlIik7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8vIOagvOW8j+WMluWOhuWPsuiusOW9leaXtumXtA0KICAgIGZvcm1hdEhpc3RvcnlUaW1lKHRpbWVzdGFtcCkgew0KICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRpbWVzdGFtcCk7DQogICAgICByZXR1cm4gZGF0ZS50b0xvY2FsZVRpbWVTdHJpbmcoInpoLUNOIiwgew0KICAgICAgICBob3VyOiAiMi1kaWdpdCIsDQogICAgICAgIG1pbnV0ZTogIjItZGlnaXQiLA0KICAgICAgICBob3VyMTI6IGZhbHNlLA0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIC8vIOiOt+WPluWOhuWPsuiusOW9leaXpeacn+WIhue7hA0KICAgIGdldEhpc3RvcnlEYXRlKHRpbWVzdGFtcCkgew0KICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKHRpbWVzdGFtcCk7DQogICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7DQogICAgICBjb25zdCB5ZXN0ZXJkYXkgPSBuZXcgRGF0ZSh0b2RheSk7DQogICAgICB5ZXN0ZXJkYXkuc2V0RGF0ZSh5ZXN0ZXJkYXkuZ2V0RGF0ZSgpIC0gMSk7DQogICAgICBjb25zdCB0d29EYXlzQWdvID0gbmV3IERhdGUodG9kYXkpOw0KICAgICAgdHdvRGF5c0Fnby5zZXREYXRlKHR3b0RheXNBZ28uZ2V0RGF0ZSgpIC0gMik7DQogICAgICBjb25zdCB0aHJlZURheXNBZ28gPSBuZXcgRGF0ZSh0b2RheSk7DQogICAgICB0aHJlZURheXNBZ28uc2V0RGF0ZSh0aHJlZURheXNBZ28uZ2V0RGF0ZSgpIC0gMyk7DQoNCiAgICAgIGlmIChkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0b2RheS50b0RhdGVTdHJpbmcoKSkgew0KICAgICAgICByZXR1cm4gIuS7iuWkqSI7DQogICAgICB9IGVsc2UgaWYgKGRhdGUudG9EYXRlU3RyaW5nKCkgPT09IHllc3RlcmRheS50b0RhdGVTdHJpbmcoKSkgew0KICAgICAgICByZXR1cm4gIuaYqOWkqSI7DQogICAgICB9IGVsc2UgaWYgKGRhdGUudG9EYXRlU3RyaW5nKCkgPT09IHR3b0RheXNBZ28udG9EYXRlU3RyaW5nKCkpIHsNCiAgICAgICAgcmV0dXJuICLkuKTlpKnliY0iOw0KICAgICAgfSBlbHNlIGlmIChkYXRlLnRvRGF0ZVN0cmluZygpID09PSB0aHJlZURheXNBZ28udG9EYXRlU3RyaW5nKCkpIHsNCiAgICAgICAgcmV0dXJuICLkuInlpKnliY0iOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmV0dXJuIGRhdGUudG9Mb2NhbGVEYXRlU3RyaW5nKCJ6aC1DTiIsIHsNCiAgICAgICAgICB5ZWFyOiAibnVtZXJpYyIsDQogICAgICAgICAgbW9udGg6ICJsb25nIiwNCiAgICAgICAgICBkYXk6ICJudW1lcmljIiwNCiAgICAgICAgfSk7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8vIOWKoOi9veWOhuWPsuiusOW9lemhuQ0KICAgIGxvYWRIaXN0b3J5SXRlbShpdGVtKSB7DQogICAgICB0cnkgew0KICAgICAgICBjb25zdCBoaXN0b3J5RGF0YSA9IEpTT04ucGFyc2UoaXRlbS5kYXRhKTsNCiAgICAgICAgDQogICAgICAgIC8vIOaBouWkjUFJ6YCJ5oup6YWN572u77yM5L2G6YeN5paw6K6+572u55+l5LmO55u0562U55qE5Zu+5qCH6Lev5b6EDQogICAgICAgIGlmIChoaXN0b3J5RGF0YS5haUxpc3QpIHsNCiAgICAgICAgICBjb25zdCB1cGRhdGVkQWlMaXN0ID0gaGlzdG9yeURhdGEuYWlMaXN0Lm1hcChhaSA9PiB7DQogICAgICAgICAgICBpZiAoYWkubmFtZSA9PT0gJ+efpeS5juebtOetlCcpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIHsgLi4uYWksIGF2YXRhcjogcmVxdWlyZSgnLi4vLi4vLi4vYXNzZXRzL2FpL3poaWh1LnBuZycpIH07DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gYWk7DQogICAgICAgICAgfSk7DQogICAgICAgICAgdGhpcy5haUxpc3QgPSB1cGRhdGVkQWlMaXN0Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIHRoaXMuYWlMaXN0ID0gdGhpcy5haUxpc3Q7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIC8vIOaBouWkjeaPkOekuuivjei+k+WFpQ0KICAgICAgICB0aGlzLnByb21wdElucHV0ID0gaGlzdG9yeURhdGEucHJvbXB0SW5wdXQgfHwgIiI7DQogICAgICAgIC8vIOaBouWkjeS7u+WKoea1geeoiw0KICAgICAgICB0aGlzLmVuYWJsZWRBSXMgPSBoaXN0b3J5RGF0YS5lbmFibGVkQUlzIHx8IFtdOw0KICAgICAgICAvLyDmgaLlpI3kuLvmnLrlj6/op4bljJYNCiAgICAgICAgdGhpcy5zY3JlZW5zaG90cyA9IGhpc3RvcnlEYXRhLnNjcmVlbnNob3RzIHx8IFtdOw0KICAgICAgICAvLyDmgaLlpI3miafooYznu5PmnpwNCiAgICAgICAgdGhpcy5yZXN1bHRzID0gaGlzdG9yeURhdGEucmVzdWx0cyB8fCBbXTsNCiAgICAgICAgLy8g5oGi5aSNY2hhdElkDQogICAgICAgIHRoaXMuY2hhdElkID0gaXRlbS5jaGF0SWQgfHwgdGhpcy5jaGF0SWQ7DQogICAgICAgIHRoaXMudXNlckluZm9SZXEudG9uZUNoYXRJZCA9IGl0ZW0udG9uZUNoYXRJZCB8fCAnJzsNCiAgICAgICAgdGhpcy51c2VySW5mb1JlcS55YkRzQ2hhdElkID0gaXRlbS55YkRzQ2hhdElkIHx8ICcnOw0KICAgICAgICB0aGlzLnVzZXJJbmZvUmVxLmRiQ2hhdElkID0gaXRlbS5kYkNoYXRJZCB8fCAnJzsNCiAgICAgICAgdGhpcy51c2VySW5mb1JlcS56aENoYXRJZCA9IGl0ZW0uemhDaGF0SWQgfHwgJyc7DQogICAgICAgIHRoaXMudXNlckluZm9SZXEubWF4Q2hhdElkID0gaXRlbS5tYXhDaGF0SWQgfHwgIiI7DQogICAgICAgIHRoaXMudXNlckluZm9SZXEuaXNOZXdDaGF0ID0gZmFsc2U7DQoNCiAgICAgICAgLy8g5bGV5byA55u45YWz5Yy65Z+fDQogICAgICAgIHRoaXMuYWN0aXZlQ29sbGFwc2VzID0gWyJhaS1zZWxlY3Rpb24iLCAicHJvbXB0LWlucHV0Il07DQogICAgICAgIHRoaXMudGFza1N0YXJ0ZWQgPSB0cnVlOw0KDQogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5Y6G5Y+y6K6w5b2V5Yqg6L295oiQ5YqfIik7DQogICAgICAgIHRoaXMuaGlzdG9yeURyYXdlclZpc2libGUgPSBmYWxzZTsNCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIuWKoOi9veWOhuWPsuiusOW9leWksei0pToiLCBlcnJvcik7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuWKoOi9veWOhuWPsuiusOW9leWksei0pSIpOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvLyDkv53lrZjljoblj7LorrDlvZUNCiAgICBhc3luYyBzYXZlSGlzdG9yeSgpIHsNCiAgICAgIC8vIGlmICghdGhpcy50YXNrU3RhcnRlZCB8fCB0aGlzLmVuYWJsZWRBSXMuc29tZShhaSA9PiBhaS5zdGF0dXMgPT09ICdydW5uaW5nJykpIHsNCiAgICAgIC8vICAgcmV0dXJuOw0KICAgICAgLy8gfQ0KDQogICAgICBjb25zdCBoaXN0b3J5RGF0YSA9IHsNCiAgICAgICAgYWlMaXN0OiB0aGlzLmFpTGlzdCwNCiAgICAgICAgcHJvbXB0SW5wdXQ6IHRoaXMucHJvbXB0SW5wdXQsDQogICAgICAgIGVuYWJsZWRBSXM6IHRoaXMuZW5hYmxlZEFJcywNCiAgICAgICAgc2NyZWVuc2hvdHM6IHRoaXMuc2NyZWVuc2hvdHMsDQogICAgICAgIHJlc3VsdHM6IHRoaXMucmVzdWx0cywNCiAgICAgICAgY2hhdElkOiB0aGlzLmNoYXRJZCwNCiAgICAgICAgdG9uZUNoYXRJZDogdGhpcy51c2VySW5mb1JlcS50b25lQ2hhdElkLA0KICAgICAgICB5YkRzQ2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLnliRHNDaGF0SWQsDQogICAgICAgIGRiQ2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLmRiQ2hhdElkLA0KICAgICAgICB6aENoYXRJZDogdGhpcy51c2VySW5mb1JlcS56aENoYXRJZCwNCiAgICAgICAgbWF4Q2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLm1heENoYXRJZCwNCiAgICAgIH07DQoNCiAgICAgIHRyeSB7DQogICAgICAgIGF3YWl0IHNhdmVVc2VyQ2hhdERhdGEoew0KICAgICAgICAgIHVzZXJJZDogdGhpcy51c2VySWQsDQogICAgICAgICAgdXNlclByb21wdDogdGhpcy5wcm9tcHRJbnB1dCwNCiAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShoaXN0b3J5RGF0YSksDQogICAgICAgICAgY2hhdElkOiB0aGlzLmNoYXRJZCwNCiAgICAgICAgICB0b25lQ2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLnRvbmVDaGF0SWQsDQogICAgICAgICAgeWJEc0NoYXRJZDogdGhpcy51c2VySW5mb1JlcS55YkRzQ2hhdElkLA0KICAgICAgICAgIGRiQ2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLmRiQ2hhdElkLA0KICAgICAgICAgIHpoQ2hhdElkOiB0aGlzLnVzZXJJbmZvUmVxLnpoQ2hhdElkLA0KICAgICAgICAgIG1heENoYXRJZDogdGhpcy51c2VySW5mb1JlcS5tYXhDaGF0SWQsDQogICAgICAgIH0pOw0KICAgICAgfSBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgY29uc29sZS5lcnJvcigi5L+d5a2Y5Y6G5Y+y6K6w5b2V5aSx6LSlOiIsIGVycm9yKTsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcigi5L+d5a2Y5Y6G5Y+y6K6w5b2V5aSx6LSlIik7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8vIOS/ruaUueaKmOWPoOWIh+aNouaWueazlQ0KICAgIHRvZ2dsZUhpc3RvcnlFeHBhbnNpb24oaXRlbSkgew0KICAgICAgdGhpcy4kc2V0KA0KICAgICAgICB0aGlzLmV4cGFuZGVkSGlzdG9yeUl0ZW1zLA0KICAgICAgICBpdGVtLmNoYXRJZCwNCiAgICAgICAgIXRoaXMuZXhwYW5kZWRIaXN0b3J5SXRlbXNbaXRlbS5jaGF0SWRdDQogICAgICApOw0KICAgIH0sDQoNCiAgICAvLyDliJvlu7rmlrDlr7nor50NCiAgICBjcmVhdGVOZXdDaGF0KCkgew0KICAgICAgLy8g6YeN572u5omA5pyJ5pWw5o2uDQogICAgICB0aGlzLmNoYXRJZCA9IHV1aWR2NCgpOw0KICAgICAgdGhpcy5pc05ld0NoYXQgPSB0cnVlOw0KICAgICAgdGhpcy5wcm9tcHRJbnB1dCA9ICIiOw0KICAgICAgdGhpcy50YXNrU3RhcnRlZCA9IGZhbHNlOw0KICAgICAgdGhpcy5zY3JlZW5zaG90cyA9IFtdOw0KICAgICAgdGhpcy5yZXN1bHRzID0gW107DQogICAgICB0aGlzLmVuYWJsZWRBSXMgPSBbXTsNCiAgICAgIHRoaXMudXNlckluZm9SZXEgPSB7DQogICAgICAgIHVzZXJQcm9tcHQ6ICIiLA0KICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLA0KICAgICAgICBjb3JwSWQ6IHRoaXMuY29ycElkLA0KICAgICAgICB0YXNrSWQ6ICcnLA0KICAgICAgICByb2xlczogJycsDQogICAgICAgIHRvbmVDaGF0SWQ6ICcnLA0KICAgICAgICB5YkRzQ2hhdElkOiAnJywNCiAgICAgICAgZGJDaGF0SWQ6ICcnLA0KICAgICAgICB6aENoYXRJZDogJycsDQogICAgICAgIG1heENoYXRJZDogJycsDQogICAgICAgIGlzTmV3Q2hhdDogdHJ1ZQ0KICAgICAgfTsNCiAgICAgIC8vIOmHjee9rkFJ5YiX6KGo5Li65Yid5aeL54q25oCBDQogICAgICB0aGlzLmFpTGlzdCA9IFsNCiAgICAgICAgew0KICAgICAgICAgIG5hbWU6ICdEZWVwU2VlaycsDQogICAgICAgICAgYXZhdGFyOiByZXF1aXJlKCcuLi8uLi8uLi9hc3NldHMvbG9nby9EZWVwc2Vlay5wbmcnKSwNCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICLmt7HluqbmgJ3ogIMiLCB2YWx1ZTogImRlZXBfdGhpbmtpbmciIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAi6IGU572R5pCc57SiIiwgdmFsdWU6ICJ3ZWJfc2VhcmNoIiB9LA0KICAgICAgICAgIF0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsnZGVlcF90aGlua2luZycsICd3ZWJfc2VhcmNoJ10sDQogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwNCiAgICAgICAgICBzdGF0dXM6ICJpZGxlIiwNCiAgICAgICAgICBwcm9ncmVzc0xvZ3M6IFtdLA0KICAgICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn55+l5LmO55u0562UJywNCiAgICAgICAgICBhdmF0YXI6IHJlcXVpcmUoJy4uLy4uLy4uL2Fzc2V0cy9haS96aGlodS5wbmcnKSwNCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICfmt7HluqbmgJ3ogIMnLCB2YWx1ZTogJ2RlZXBfdGhpbmtpbmcnIH0NCiAgICAgICAgICBdLA0KICAgICAgICAgIHNlbGVjdGVkQ2FwYWJpbGl0aWVzOiBbJ2RlZXBfdGhpbmtpbmcnXSwNCiAgICAgICAgICBlbmFibGVkOiB0cnVlLA0KICAgICAgICAgIHN0YXR1czogJ2lkbGUnLA0KICAgICAgICAgIHByb2dyZXNzTG9nczogW10sDQogICAgICAgICAgaXNFeHBhbmRlZDogdHJ1ZQ0KICAgICAgICB9LA0KICAgICAgICB7DQogICAgICAgICAgbmFtZTogIk1pbmlNYXggQ2hhdCIsDQogICAgICAgICAgYXZhdGFyOiByZXF1aXJlKCIuLi8uLi8uLi9hc3NldHMvYWkvTWluaU1heC5wbmciKSwNCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IFsNCiAgICAgICAgICAgIHsgbGFiZWw6ICLmt7HluqbmgJ3ogIMiLCB2YWx1ZTogImRlZXBfdGhpbmtpbmciIH0sDQogICAgICAgICAgICB7IGxhYmVsOiAi6IGU572RIiwgdmFsdWU6ICJ3ZWJfc2VhcmNoIiB9LA0KICAgICAgICAgIF0sDQogICAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFsiZGVlcF90aGlua2luZyIsICJ3ZWJfc2VhcmNoIl0sDQogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwNCiAgICAgICAgICBzdGF0dXM6ICJpZGxlIiwNCiAgICAgICAgICBwcm9ncmVzc0xvZ3M6IFtdLA0KICAgICAgICAgIGlzRXhwYW5kZWQ6IHRydWUsDQogICAgICAgIH0sDQogICAgICAgIHsNCiAgICAgICAgICBuYW1lOiAn6LGG5YyFJywNCiAgICAgICAgICBhdmF0YXI6IHJlcXVpcmUoJy4uLy4uLy4uL2Fzc2V0cy9haS/osYbljIUucG5nJyksDQogICAgICAgICAgY2FwYWJpbGl0aWVzOiBbDQogICAgICAgICAgICB7IGxhYmVsOiAn5rex5bqm5oCd6ICDJywgdmFsdWU6ICdkZWVwX3RoaW5raW5nJyB9DQogICAgICAgICAgXSwNCiAgICAgICAgICBzZWxlY3RlZENhcGFiaWxpdGllczogWydkZWVwX3RoaW5raW5nJ10sDQogICAgICAgICAgZW5hYmxlZDogdHJ1ZSwNCiAgICAgICAgICBzdGF0dXM6ICdpZGxlJywNCiAgICAgICAgICBwcm9ncmVzc0xvZ3M6IFtdLA0KICAgICAgICAgIGlzRXhwYW5kZWQ6IHRydWUNCiAgICAgICAgfQ0KICAgICAgXTsNCiAgICAgIC8vIOWxleW8gOebuOWFs+WMuuWfnw0KICAgICAgdGhpcy5hY3RpdmVDb2xsYXBzZXMgPSBbImFpLXNlbGVjdGlvbiIsICJwcm9tcHQtaW5wdXQiXTsNCg0KICAgICAgdGhpcy4kbWVzc2FnZS5zdWNjZXNzKCLlt7LliJvlu7rmlrDlr7nor50iKTsNCiAgICB9LA0KDQogICAgLy8g5Yqg6L295LiK5qyh5Lya6K+dDQogICAgYXN5bmMgbG9hZExhc3RDaGF0KCkgew0KICAgICAgdHJ5IHsNCiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZ2V0Q2hhdEhpc3RvcnkodGhpcy51c2VySWQsIDApOw0KICAgICAgICBpZiAocmVzLmNvZGUgPT09IDIwMCAmJiByZXMuZGF0YSAmJiByZXMuZGF0YS5sZW5ndGggPiAwKSB7DQogICAgICAgICAgLy8g6I635Y+W5pyA5paw55qE5Lya6K+d6K6w5b2VDQogICAgICAgICAgY29uc3QgbGFzdENoYXQgPSByZXMuZGF0YVswXTsNCiAgICAgICAgICB0aGlzLmxvYWRIaXN0b3J5SXRlbShsYXN0Q2hhdCk7DQogICAgICAgIH0NCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7DQogICAgICAgIGNvbnNvbGUuZXJyb3IoIuWKoOi9veS4iuasoeS8muivneWksei0pToiLCBlcnJvcik7DQogICAgICB9DQogICAgfSwNCg0KICAgIC8vIOWIpOaWreaYr+WQpuS4uuWbvueJh+aWh+S7tg0KICAgIGlzSW1hZ2VGaWxlKHVybCkgew0KICAgICAgaWYgKCF1cmwpIHJldHVybiBmYWxzZTsNCiAgICAgIGNvbnN0IGltYWdlRXh0ZW5zaW9ucyA9IFsNCiAgICAgICAgIi5qcGciLA0KICAgICAgICAiLmpwZWciLA0KICAgICAgICAiLnBuZyIsDQogICAgICAgICIuZ2lmIiwNCiAgICAgICAgIi5ibXAiLA0KICAgICAgICAiLndlYnAiLA0KICAgICAgICAiLnN2ZyIsDQogICAgICBdOw0KICAgICAgY29uc3QgdXJsTG93ZXIgPSB1cmwudG9Mb3dlckNhc2UoKTsNCiAgICAgIHJldHVybiBpbWFnZUV4dGVuc2lvbnMuc29tZSgoZXh0KSA9PiB1cmxMb3dlci5pbmNsdWRlcyhleHQpKTsNCiAgICB9LA0KDQogICAgLy8g5Yik5pat5piv5ZCm5Li6UERG5paH5Lu2DQogICAgaXNQZGZGaWxlKHVybCkgew0KICAgICAgaWYgKCF1cmwpIHJldHVybiBmYWxzZTsNCiAgICAgIHJldHVybiB1cmwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiLnBkZiIpOw0KICAgIH0sDQoNCiAgICAvLyDmoLnmja5BSeWQjeensOiOt+WPluWbvueJh+agt+W8jw0KICAgIGdldEltYWdlU3R5bGUoYWlOYW1lKSB7DQogICAgICBjb25zdCB3aWR0aE1hcCA9IHsNCiAgICAgICAgRGVlcFNlZWs6ICI3MDBweCIsDQogICAgICAgIOixhuWMhTogIjU2MHB4IiwNCiAgICAgIH07DQoNCiAgICAgIGNvbnN0IHdpZHRoID0gd2lkdGhNYXBbYWlOYW1lXSB8fCAiNTYwcHgiOyAvLyDpu5jorqTlrr3luqYNCg0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgd2lkdGg6IHdpZHRoLA0KICAgICAgICBoZWlnaHQ6ICJhdXRvIiwNCiAgICAgIH07DQogICAgfSwNCg0KICAgIC8vIOaKlemAkuWIsOWFrOS8l+WPtw0KICAgIGhhbmRsZVB1c2hUb1dlY2hhdChyZXN1bHQpIHsNCiAgICAgIHRoaXMuc2hvd0xheW91dERpYWxvZyhyZXN1bHQpOw0KICAgIH0sDQoNCiAgICAvLyDmmL7npLrmmbrog73mjpLniYjlr7nor53moYYNCiAgICBzaG93TGF5b3V0RGlhbG9nKHJlc3VsdCkgew0KICAgICAgdGhpcy5jdXJyZW50TGF5b3V0UmVzdWx0ID0gcmVzdWx0Ow0KICAgICAgdGhpcy5sYXlvdXRQcm9tcHQgPQ0KICAgICAgICBg6K+35L2g5a+55Lul5LiLIEhUTUwg5YaF5a656L+b6KGM5o6S54mI5LyY5YyW77yM55uu5qCH5piv55So5LqO5b6u5L+h5YWs5LyX5Y+3IuiNieeov+euseaOpeWPoyLnmoQgY29udGVudCDlrZfmrrXvvIzopoHmsYLlpoLkuIvvvJoNCg0KMS4g5LuF6L+U5ZueIDxib2R5PiDlhoXpg6jlj6/nlKjnmoQgSFRNTCDlhoXlrrnniYfmrrXvvIjkuI3opoHljIXlkKsgPCFET0NUWVBFPuOAgTxodG1sPuOAgTxoZWFkPuOAgTxtZXRhPuOAgTx0aXRsZT4g562J5qCH562+77yJ44CCDQoyLiDmiYDmnInmoLflvI/lv4Xpobvku6Ui5YaF6IGUIHN0eWxlIuaWueW8j+WGmeWFpeOAgg0KMy4g5L+d5oyB57uT5p6E5riF5pmw44CB6KeG6KeJ5Y+L5aW977yM6YCC6YWN5YWs5LyX5Y+35Zu+5paH5o6S54mI44CCDQo0LiDor7fnm7TmjqXovpPlh7rku6PnoIHvvIzkuI3opoHmt7vliqDku7vkvZXms6jph4rmiJbpop3lpJbor7TmmI7jgIINCjUuIOS4jeW+l+S9v+eUqCBlbW9qaSDooajmg4XnrKblj7fmiJblsI/lm77moIflrZfnrKbjgIINCjYuIOS4jeimgeaYvuekuuS4uumXruetlOW9ouW8j++8jOS7peS4gOevh+aWh+eroOeahOagvOW8j+WOu+iwg+aVtCBcblxu5Lul5LiL5Li66ZyA6KaB6L+b6KGM5o6S54mI5LyY5YyW55qE5YaF5a6577yaXG5gICsNCiAgICAgICAgcmVzdWx0LmNvbnRlbnQ7DQogICAgICB0aGlzLmxheW91dERpYWxvZ1Zpc2libGUgPSB0cnVlOw0KICAgIH0sDQoNCiAgICAvLyDlpITnkIbmmbrog73mjpLniYgNCiAgICBoYW5kbGVMYXlvdXQoKSB7DQogICAgICBpZiAoIXRoaXMuY2FuTGF5b3V0IHx8ICF0aGlzLmN1cnJlbnRMYXlvdXRSZXN1bHQpIHJldHVybjsNCg0KICAgICAgLy8g5p6E5bu65o6S54mI6K+35rGCDQogICAgICBjb25zdCBsYXlvdXRSZXF1ZXN0ID0gew0KICAgICAgICBqc29ucnBjOiAiMi4wIiwNCiAgICAgICAgaWQ6IHV1aWR2NCgpLA0KICAgICAgICBtZXRob2Q6ICJBSeaOkueJiCIsDQogICAgICAgIHBhcmFtczogew0KICAgICAgICAgIHRhc2tJZDogdXVpZHY0KCksDQogICAgICAgICAgdXNlcklkOiB0aGlzLnVzZXJJZCwNCiAgICAgICAgICBjb3JwSWQ6IHRoaXMuY29ycElkLA0KICAgICAgICAgIHVzZXJQcm9tcHQ6IHRoaXMubGF5b3V0UHJvbXB0LA0KICAgICAgICAgIHJvbGVzOiAiIiwgLy8g6buY6K6k5L2/55So6LGG5YyF6L+b6KGM5o6S54mIDQogICAgICAgIH0sDQogICAgICB9Ow0KDQogICAgICAvLyDlj5HpgIHmjpLniYjor7fmsYINCiAgICAgIGNvbnNvbGUubG9nKCLmjpLniYjlj4LmlbAiLCBsYXlvdXRSZXF1ZXN0KTsNCiAgICAgIHRoaXMubWVzc2FnZShsYXlvdXRSZXF1ZXN0KTsNCiAgICAgIHRoaXMubGF5b3V0RGlhbG9nVmlzaWJsZSA9IGZhbHNlOw0KDQogICAgICAvLyDliJvlu7rmmbrog73mjpLniYhBSeiKgueCuQ0KICAgICAgY29uc3Qgem5wYkFJID0gew0KICAgICAgICBuYW1lOiAi5pm66IO95o6S54mIIiwNCiAgICAgICAgYXZhdGFyOiByZXF1aXJlKCIuLi8uLi8uLi9hc3NldHMvYWkveXVhbmJhby5wbmciKSwNCiAgICAgICAgY2FwYWJpbGl0aWVzOiBbXSwNCiAgICAgICAgc2VsZWN0ZWRDYXBhYmlsaXRpZXM6IFtdLA0KICAgICAgICBlbmFibGVkOiB0cnVlLA0KICAgICAgICBzdGF0dXM6ICJydW5uaW5nIiwNCiAgICAgICAgcHJvZ3Jlc3NMb2dzOiBbDQogICAgICAgICAgew0KICAgICAgICAgICAgY29udGVudDogIuaZuuiDveaOkueJiOS7u+WKoeW3suaPkOS6pO+8jOato+WcqOaOkueJiC4uLiIsDQogICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksDQogICAgICAgICAgICBpc0NvbXBsZXRlZDogZmFsc2UsDQogICAgICAgICAgICB0eXBlOiAi5pm66IO95o6S54mIIiwNCiAgICAgICAgICB9LA0KICAgICAgICBdLA0KICAgICAgICBpc0V4cGFuZGVkOiB0cnVlLA0KICAgICAgfTsNCg0KICAgICAgLy8g5qOA5p+l5piv5ZCm5bey5a2Y5Zyo5pm66IO95o6S54mIDQogICAgICBjb25zdCBleGlzdEluZGV4ID0gdGhpcy5lbmFibGVkQUlzLmZpbmRJbmRleCgNCiAgICAgICAgKGFpKSA9PiBhaS5uYW1lID09PSAi5pm66IO95o6S54mIIg0KICAgICAgKTsNCiAgICAgIGlmIChleGlzdEluZGV4ID09PSAtMSkgew0KICAgICAgICAvLyDlpoLmnpzkuI3lrZjlnKjvvIzmt7vliqDliLDmlbDnu4TlvIDlpLQNCiAgICAgICAgdGhpcy5lbmFibGVkQUlzLnVuc2hpZnQoem5wYkFJKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIOWmguaenOW3suWtmOWcqO+8jOabtOaWsOeKtuaAgeWSjOaXpeW/lw0KICAgICAgICB0aGlzLmVuYWJsZWRBSXNbZXhpc3RJbmRleF0gPSB6bnBiQUk7DQogICAgICAgIC8vIOWwhuaZuuiDveaOkueJiOenu+WIsOaVsOe7hOW8gOWktA0KICAgICAgICBjb25zdCB6bnBiID0gdGhpcy5lbmFibGVkQUlzLnNwbGljZShleGlzdEluZGV4LCAxKVswXTsNCiAgICAgICAgdGhpcy5lbmFibGVkQUlzLnVuc2hpZnQoem5wYik7DQogICAgICB9DQoNCiAgICAgIHRoaXMuJGZvcmNlVXBkYXRlKCk7DQogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuaOkueJiOivt+axguW3suWPkemAge+8jOivt+etieW+hee7k+aenCIpOw0KICAgIH0sDQoNCiAgICAvLyDlrp7pmYXmipXpgJLliLDlhazkvJflj7cNCiAgICBwdXNoVG9XZWNoYXRXaXRoQ29udGVudChjb250ZW50VGV4dCkgew0KICAgICAgaWYgKHRoaXMucHVzaGluZ1RvV2VjaGF0KSByZXR1cm47DQogICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIuW8gOWni+aKlemAkuWFrOS8l+WPt++8gSIpOw0KICAgICAgdGhpcy5wdXNoaW5nVG9XZWNoYXQgPSB0cnVlOw0KICAgICAgdGhpcy5wdXNoT2ZmaWNlTnVtICs9IDE7DQoNCiAgICAgIGNvbnN0IHBhcmFtcyA9IHsNCiAgICAgICAgY29udGVudFRleHQ6IGNvbnRlbnRUZXh0LA0KICAgICAgICBzaGFyZVVybDogdGhpcy5jdXJyZW50TGF5b3V0UmVzdWx0LnNoYXJlVXJsLA0KICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLA0KICAgICAgICBudW06IHRoaXMucHVzaE9mZmljZU51bSwNCiAgICAgICAgYWlOYW1lOiB0aGlzLmN1cnJlbnRMYXlvdXRSZXN1bHQuYWlOYW1lLA0KICAgICAgfTsNCg0KICAgICAgcHVzaEF1dG9PZmZpY2UocGFyYW1zKQ0KICAgICAgICAudGhlbigocmVzKSA9PiB7DQogICAgICAgICAgaWYgKHJlcy5jb2RlID09PSAyMDApIHsNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5oqV6YCS5Yiw5YWs5LyX5Y+35oiQ5Yqf77yBIik7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyB8fCAi5oqV6YCS5aSx6LSl77yM6K+36YeN6K+VIik7DQogICAgICAgICAgfQ0KICAgICAgICB9KQ0KICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7DQogICAgICAgICAgY29uc29sZS5lcnJvcigi5oqV6YCS5Yiw5YWs5LyX5Y+35aSx6LSlOiIsIGVycm9yKTsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLmipXpgJLlpLHotKXvvIzor7fph43or5UiKTsNCiAgICAgICAgfSkNCiAgICAgICAgLmZpbmFsbHkoKCkgPT4gew0KICAgICAgICAgIHRoaXMucHVzaGluZ1RvV2VjaGF0ID0gZmFsc2U7DQogICAgICAgIH0pOw0KICAgIH0sDQogIH0sDQp9Ow0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/wechat/chrome","sourcesContent":["<template>\r\n  <div class=\"ai-management-platform\">\r\n    <!-- 顶部导航区 -->\r\n    <div class=\"top-nav\">\r\n      <div class=\"logo-area\">\r\n        <img src=\"../../../assets/ai/logo.png\" alt=\"Logo\" class=\"logo\" />\r\n        <h1 class=\"platform-title\">主机</h1>\r\n      </div>\r\n      <div class=\"nav-buttons\">\r\n        <el-button type=\"primary\" size=\"small\" @click=\"createNewChat\">\r\n          <i class=\"el-icon-plus\"></i>\r\n          创建新对话\r\n        </el-button>\r\n        <div class=\"history-button\">\r\n          <el-button type=\"text\" @click=\"showHistoryDrawer\">\r\n            <img\r\n              :src=\"require('../../../assets/ai/celan.png')\"\r\n              alt=\"历史记录\"\r\n              class=\"history-icon\"\r\n            />\r\n          </el-button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 历史记录抽屉 -->\r\n    <el-drawer\r\n      title=\"历史会话记录\"\r\n      :visible.sync=\"historyDrawerVisible\"\r\n      direction=\"rtl\"\r\n      size=\"30%\"\r\n      :before-close=\"handleHistoryDrawerClose\"\r\n    >\r\n      <div class=\"history-content\">\r\n        <div\r\n          v-for=\"(group, date) in groupedHistory\"\r\n          :key=\"date\"\r\n          class=\"history-group\"\r\n        >\r\n          <div class=\"history-date\">{{ date }}</div>\r\n          <div class=\"history-list\">\r\n            <div\r\n              v-for=\"(item, index) in group\"\r\n              :key=\"index\"\r\n              class=\"history-item\"\r\n            >\r\n              <div class=\"history-parent\" @click=\"loadHistoryItem(item)\">\r\n                <div class=\"history-header\">\r\n                  <i\r\n                    :class=\"[\r\n                      'el-icon-arrow-right',\r\n                      { 'is-expanded': item.isExpanded },\r\n                    ]\"\r\n                    @click.stop=\"toggleHistoryExpansion(item)\"\r\n                  ></i>\r\n                  <div class=\"history-prompt\">{{ item.userPrompt }}</div>\r\n                </div>\r\n                <div class=\"history-time\">\r\n                  {{ formatHistoryTime(item.createTime) }}\r\n                </div>\r\n              </div>\r\n              <div\r\n                v-if=\"\r\n                  item.children && item.children.length > 0 && item.isExpanded\r\n                \"\r\n                class=\"history-children\"\r\n              >\r\n                <div\r\n                  v-for=\"(child, childIndex) in item.children\"\r\n                  :key=\"childIndex\"\r\n                  class=\"history-child-item\"\r\n                  @click=\"loadHistoryItem(child)\"\r\n                >\r\n                  <div class=\"history-prompt\">{{ child.userPrompt }}</div>\r\n                  <div class=\"history-time\">\r\n                    {{ formatHistoryTime(child.createTime) }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </el-drawer>\r\n\r\n    <div class=\"main-content\">\r\n      <el-collapse v-model=\"activeCollapses\">\r\n        <el-collapse-item title=\"AI选择配置\" name=\"ai-selection\">\r\n          <div class=\"ai-selection-section\">\r\n            <div class=\"ai-cards\">\r\n              <el-card\r\n                v-for=\"(ai, index) in aiList\"\r\n                :key=\"index\"\r\n                class=\"ai-card\"\r\n                shadow=\"hover\"\r\n              >\r\n                <div class=\"ai-card-header\">\r\n                  <div class=\"ai-left\">\r\n                    <div class=\"ai-avatar\">\r\n                      <img :src=\"ai.avatar\" alt=\"AI头像\" />\r\n                    </div>\r\n                    <div class=\"ai-name\">{{ ai.name }}</div>\r\n                  </div>\r\n                  <div class=\"ai-status\">\r\n                    <el-switch\r\n                      v-model=\"ai.enabled\"\r\n                      active-color=\"#13ce66\"\r\n                      inactive-color=\"#ff4949\"\r\n                    >\r\n                    </el-switch>\r\n                  </div>\r\n                </div>\r\n                <div\r\n                  class=\"ai-capabilities\"\r\n                  v-if=\"ai.capabilities && ai.capabilities.length > 0\"\r\n                >\r\n                  <div class=\"button-capability-group\">\r\n                    <el-button\r\n                      v-for=\"capability in ai.capabilities\"\r\n                      :key=\"capability.value\"\r\n                      size=\"mini\"\r\n                      :type=\"\r\n                        ai.selectedCapabilities.includes(capability.value)\r\n                          ? 'primary'\r\n                          : 'info'\r\n                      \"\r\n                      :disabled=\"!ai.enabled\"\r\n                      :plain=\"\r\n                        !ai.selectedCapabilities.includes(capability.value)\r\n                      \"\r\n                      @click=\"toggleCapability(ai, capability.value)\"\r\n                      class=\"capability-button\"\r\n                    >\r\n                      {{ capability.label }}\r\n                    </el-button>\r\n                  </div>\r\n                </div>\r\n              </el-card>\r\n            </div>\r\n          </div>\r\n        </el-collapse-item>\r\n\r\n        <!-- 提示词输入区 -->\r\n        <el-collapse-item title=\"提示词输入\" name=\"prompt-input\">\r\n          <div class=\"prompt-input-section\">\r\n            <el-input\r\n              type=\"textarea\"\r\n              :rows=\"5\"\r\n              placeholder=\"请输入提示词，支持Markdown格式\"\r\n              v-model=\"promptInput\"\r\n              resize=\"none\"\r\n              class=\"prompt-input\"\r\n            >\r\n            </el-input>\r\n            <div class=\"prompt-footer\">\r\n              <div class=\"word-count\">字数统计: {{ promptInput.length }}</div>\r\n              <el-button\r\n                type=\"primary\"\r\n                @click=\"sendPrompt\"\r\n                :disabled=\"!canSend\"\r\n                class=\"send-button\"\r\n              >\r\n                发送\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </el-collapse-item>\r\n      </el-collapse>\r\n\r\n      <!-- 执行状态展示区 -->\r\n      <div class=\"execution-status-section\" v-if=\"taskStarted\">\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-card class=\"task-flow-card\">\r\n              <div slot=\"header\" class=\"card-header\">\r\n                <span>任务流程</span>\r\n              </div>\r\n              <div class=\"task-flow\">\r\n                <div\r\n                  v-for=\"(ai, index) in enabledAIs\"\r\n                  :key=\"index\"\r\n                  class=\"task-item\"\r\n                >\r\n                  <div class=\"task-header\" @click=\"toggleAIExpansion(ai)\">\r\n                    <div class=\"header-left\">\r\n                      <i\r\n                        :class=\"[\r\n                          'el-icon-arrow-right',\r\n                          { 'is-expanded': ai.isExpanded },\r\n                        ]\"\r\n                      ></i>\r\n                      <span class=\"ai-name\">{{ ai.name }}</span>\r\n                    </div>\r\n                    <div class=\"header-right\">\r\n                      <span class=\"status-text\">{{\r\n                        getStatusText(ai.status)\r\n                      }}</span>\r\n                      <i\r\n                        :class=\"getStatusIcon(ai.status)\"\r\n                        class=\"status-icon\"\r\n                      ></i>\r\n                    </div>\r\n                  </div>\r\n                  <!-- 添加进度轨迹 -->\r\n                  <div\r\n                    class=\"progress-timeline\"\r\n                    v-if=\"ai.progressLogs.length > 0 && ai.isExpanded\"\r\n                  >\r\n                    <div class=\"timeline-scroll\">\r\n                      <div\r\n                        v-for=\"(log, logIndex) in ai.progressLogs\"\r\n                        :key=\"logIndex\"\r\n                        class=\"progress-item\"\r\n                        :class=\"{\r\n                          completed: log.isCompleted || logIndex > 0,\r\n                          current: !log.isCompleted && logIndex === 0,\r\n                        }\"\r\n                      >\r\n                        <div class=\"progress-dot\"></div>\r\n                        <div\r\n                          class=\"progress-line\"\r\n                          v-if=\"logIndex < ai.progressLogs.length - 1\"\r\n                        ></div>\r\n                        <div class=\"progress-content\">\r\n                          <div class=\"progress-time\">\r\n                            {{ formatTime(log.timestamp) }}\r\n                          </div>\r\n                          <div class=\"progress-text\">{{ log.content }}</div>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </el-card>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-card class=\"screenshots-card\">\r\n              <div slot=\"header\" class=\"card-header\">\r\n                <span>主机可视化</span>\r\n                <div class=\"controls\">\r\n                  <el-switch\r\n                    v-model=\"autoPlay\"\r\n                    active-text=\"自动轮播\"\r\n                    inactive-text=\"手动切换\"\r\n                  >\r\n                  </el-switch>\r\n                </div>\r\n              </div>\r\n              <div class=\"screenshots\">\r\n                <el-carousel\r\n                  :interval=\"3000\"\r\n                  :autoplay=\"false\"\r\n                  indicator-position=\"outside\"\r\n                  height=\"700px\"\r\n                >\r\n                  <el-carousel-item\r\n                    v-for=\"(screenshot, index) in screenshots\"\r\n                    :key=\"index\"\r\n                  >\r\n                    <img\r\n                      :src=\"screenshot\"\r\n                      alt=\"执行截图\"\r\n                      class=\"screenshot-image\"\r\n                      @click=\"showLargeImage(screenshot)\"\r\n                    />\r\n                  </el-carousel-item>\r\n                </el-carousel>\r\n              </div>\r\n            </el-card>\r\n          </el-col>\r\n        </el-row>\r\n      </div>\r\n\r\n      <!-- 结果展示区 -->\r\n      <div class=\"results-section\" v-if=\"results.length > 0\">\r\n        <div class=\"section-header\">\r\n          <h2 class=\"section-title\">执行结果</h2>\r\n          <el-button type=\"primary\" @click=\"showScoreDialog\" size=\"small\">\r\n            智能评分\r\n          </el-button>\r\n        </div>\r\n        <el-tabs v-model=\"activeResultTab\" type=\"card\">\r\n          <el-tab-pane\r\n            v-for=\"(result, index) in results\"\r\n            :key=\"index\"\r\n            :label=\"result.aiName\"\r\n            :name=\"'result-' + index\"\r\n          >\r\n            <div class=\"result-content\">\r\n              <div class=\"result-header\" v-if=\"result.shareUrl\">\r\n                <div class=\"result-title\">{{ result.aiName }}的执行结果</div>\r\n                <div class=\"result-buttons\">\r\n                  <el-button\r\n                    size=\"mini\"\r\n                    type=\"primary\"\r\n                    icon=\"el-icon-link\"\r\n                    @click=\"openShareUrl(result.shareUrl)\"\r\n                    class=\"share-link-btn\"\r\n                  >\r\n                    查看原链接\r\n                  </el-button>\r\n                  <el-button\r\n                    size=\"mini\"\r\n                    type=\"success\"\r\n                    icon=\"el-icon-s-promotion\"\r\n                    @click=\"handlePushToWechat(result)\"\r\n                    class=\"push-wechat-btn\"\r\n                    :loading=\"pushingToWechat\"\r\n                    :disabled=\"pushingToWechat\"\r\n                  >\r\n                    投递到公众号\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n              <!-- 如果有shareImgUrl则渲染图片或PDF，否则渲染markdown -->\r\n              <div v-if=\"result.shareImgUrl\" class=\"share-content\">\r\n                <!-- 渲染图片 -->\r\n                <img\r\n                  v-if=\"isImageFile(result.shareImgUrl)\"\r\n                  :src=\"result.shareImgUrl\"\r\n                  alt=\"分享图片\"\r\n                  class=\"share-image\"\r\n                  :style=\"getImageStyle(result.aiName)\"\r\n                />\r\n                <!-- 渲染PDF -->\r\n                <iframe\r\n                  v-else-if=\"isPdfFile(result.shareImgUrl)\"\r\n                  :src=\"result.shareImgUrl\"\r\n                  class=\"share-pdf\"\r\n                  frameborder=\"0\"\r\n                >\r\n                </iframe>\r\n                <!-- 其他文件类型显示链接 -->\r\n                <div v-else class=\"share-file\">\r\n                  <el-button\r\n                    type=\"primary\"\r\n                    icon=\"el-icon-document\"\r\n                    @click=\"openShareUrl(result.shareImgUrl)\"\r\n                  >\r\n                    查看文件\r\n                  </el-button>\r\n                </div>\r\n              </div>\r\n              <div\r\n                v-else\r\n                class=\"markdown-content\"\r\n                v-html=\"renderMarkdown(result.content)\"\r\n              ></div>\r\n              <div class=\"action-buttons\">\r\n                <el-button\r\n                  size=\"small\"\r\n                  type=\"primary\"\r\n                  @click=\"copyResult(result.content)\"\r\n                  >复制（纯文本）</el-button\r\n                >\r\n                <el-button\r\n                  size=\"small\"\r\n                  type=\"success\"\r\n                  @click=\"exportResult(result)\"\r\n                  >导出（MD文件）</el-button\r\n                >\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 大图查看对话框 -->\r\n    <el-dialog\r\n      :visible.sync=\"showImageDialog\"\r\n      width=\"90%\"\r\n      :show-close=\"true\"\r\n      :modal=\"true\"\r\n      center\r\n      class=\"image-dialog\"\r\n      :append-to-body=\"true\"\r\n      @close=\"closeLargeImage\"\r\n    >\r\n      <div class=\"large-image-container\">\r\n        <!-- 如果是单张分享图片，直接显示 -->\r\n        <div\r\n          v-if=\"currentLargeImage && !screenshots.includes(currentLargeImage)\"\r\n          class=\"single-image-container\"\r\n        >\r\n          <img :src=\"currentLargeImage\" alt=\"大图\" class=\"large-image\" />\r\n        </div>\r\n        <!-- 如果是截图轮播 -->\r\n        <el-carousel\r\n          v-else\r\n          :interval=\"3000\"\r\n          :autoplay=\"false\"\r\n          indicator-position=\"outside\"\r\n          height=\"80vh\"\r\n        >\r\n          <el-carousel-item\r\n            v-for=\"(screenshot, index) in screenshots\"\r\n            :key=\"index\"\r\n          >\r\n            <img :src=\"screenshot\" alt=\"大图\" class=\"large-image\" />\r\n          </el-carousel-item>\r\n        </el-carousel>\r\n      </div>\r\n    </el-dialog>\r\n\r\n    <!-- 评分弹窗 -->\r\n    <el-dialog\r\n      title=\"智能评分\"\r\n      :visible.sync=\"scoreDialogVisible\"\r\n      width=\"60%\"\r\n      height=\"65%\"\r\n      :close-on-click-modal=\"false\"\r\n      class=\"score-dialog\"\r\n    >\r\n      <div class=\"score-dialog-content\">\r\n        <div class=\"score-prompt-section\">\r\n          <h3>评分提示词：</h3>\r\n          <el-input\r\n            type=\"textarea\"\r\n            :rows=\"10\"\r\n            placeholder=\"请输入评分提示词，例如：请从内容质量、逻辑性、创新性等方面进行评分\"\r\n            v-model=\"scorePrompt\"\r\n            resize=\"none\"\r\n            class=\"score-prompt-input\"\r\n          >\r\n          </el-input>\r\n        </div>\r\n        <div class=\"selected-results\">\r\n          <h3>选择要评分的内容：</h3>\r\n          <el-checkbox-group v-model=\"selectedResults\">\r\n            <el-checkbox\r\n              v-for=\"(result, index) in results\"\r\n              :key=\"index\"\r\n              :label=\"result.aiName\"\r\n              class=\"result-checkbox\"\r\n            >\r\n              {{ result.aiName }}\r\n            </el-checkbox>\r\n          </el-checkbox-group>\r\n        </div>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"scoreDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleScore\" :disabled=\"!canScore\">\r\n          开始评分\r\n        </el-button>\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <!-- 智能排版弹窗 -->\r\n    <el-dialog\r\n      title=\"智能排版\"\r\n      :visible.sync=\"layoutDialogVisible\"\r\n      width=\"60%\"\r\n      height=\"65%\"\r\n      :close-on-click-modal=\"false\"\r\n      class=\"layout-dialog\"\r\n    >\r\n      <div class=\"layout-dialog-content\">\r\n        <div class=\"layout-prompt-section\">\r\n          <h3>排版提示词：</h3>\r\n          <el-input\r\n            type=\"textarea\"\r\n            :rows=\"15\"\r\n            placeholder=\"请输入排版提示词\"\r\n            v-model=\"layoutPrompt\"\r\n            resize=\"none\"\r\n            class=\"layout-prompt-input\"\r\n          >\r\n          </el-input>\r\n        </div>\r\n      </div>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"layoutDialogVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleLayout\" :disabled=\"!canLayout\">\r\n          开始排版\r\n        </el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { marked } from \"marked\";\r\nimport {\r\n  message,\r\n  saveUserChatData,\r\n  getChatHistory,\r\n  pushAutoOffice,\r\n} from \"@/api/wechat/aigc\";\r\nimport { v4 as uuidv4 } from \"uuid\";\r\nimport websocketClient from \"@/utils/websocket\";\r\nimport store from \"@/store\";\r\nimport TurndownService from \"turndown\";\r\n\r\nexport default {\r\n  name: \"AIManagementPlatform\",\r\n  data() {\r\n    return {\r\n      userId: store.state.user.id,\r\n      corpId: store.state.user.corp_id,\r\n      chatId: uuidv4(),\r\n      expandedHistoryItems: {},\r\n      userInfoReq: {\r\n        userPrompt: '',\r\n        userId: '',\r\n        corpId: '',\r\n        taskId: '',\r\n        roles: '',\r\n        toneChatId: '',\r\n        ybDsChatId: '',\r\n        dbChatId: '',\r\n        zhChatId: '',\r\n        isNewChat: true,\r\n      },\r\n      jsonRpcReqest: {\r\n        jsonrpc: \"2.0\",\r\n        id: uuidv4(),\r\n        method: \"\",\r\n        params: {},\r\n      },\r\n      aiList: [\r\n        {\r\n          name: 'DeepSeek',\r\n          avatar: require('../../../assets/logo/Deepseek.png'),\r\n          capabilities: [\r\n            { label: \"深度思考\", value: \"deep_thinking\" },\r\n            { label: \"联网搜索\", value: \"web_search\" },\r\n          ],\r\n          selectedCapabilities: [\"deep_thinking\", \"web_search\"],\r\n          enabled: true,\r\n          status: \"idle\",\r\n          progressLogs: [],\r\n          isExpanded: true,\r\n        },\r\n        {     \r\n          name: '知乎直答',\r\n          avatar: require('../../../assets/ai/zhihu.png'),\r\n          capabilities: [\r\n            { label: '深度思考', value: 'deep_thinking' }\r\n          ],\r\n          selectedCapabilities: ['deep_thinking'],\r\n          enabled: true,\r\n          status: 'idle',\r\n          progressLogs: [],\r\n          isExpanded: true\r\n        },\r\n        {\r\n          name: \"豆包\",\r\n          avatar: require(\"../../../assets/ai/豆包.png\"),\r\n          capabilities: [{ label: \"深度思考\", value: \"deep_thinking\" }],\r\n          selectedCapabilities: [\"deep_thinking\"],\r\n          enabled: true,\r\n          status: \"idle\",\r\n          progressLogs: [],\r\n          isExpanded: true,\r\n        },\r\n        {\r\n          name: \"MiniMax Chat\",\r\n          avatar: require(\"../../../assets/ai/MiniMax.png\"),\r\n          capabilities: [\r\n            { label: \"深度思考\", value: \"deep_thinking\" },\r\n            { label: \"联网搜索\", value: \"web_search\" },\r\n          ],\r\n          selectedCapabilities: [\"deep_thinking\", \"web_search\"],\r\n          enabled: true,\r\n          status: \"idle\",\r\n          progressLogs: [],\r\n          isExpanded: true,\r\n        },\r\n      ],\r\n      promptInput: \"\",\r\n      taskStarted: false,\r\n      autoPlay: false,\r\n      screenshots: [],\r\n      results: [],\r\n      activeResultTab: \"result-0\",\r\n      activeCollapses: [\"ai-selection\", \"prompt-input\"], // 默认展开这两个区域\r\n      showImageDialog: false,\r\n      currentLargeImage: \"\",\r\n      enabledAIs: [],\r\n      turndownService: new TurndownService({\r\n        headingStyle: \"atx\",\r\n        codeBlockStyle: \"fenced\",\r\n        emDelimiter: \"*\",\r\n      }),\r\n      scoreDialogVisible: false,\r\n      selectedResults: [],\r\n      scorePrompt: `请你深度阅读以下几篇内容，从多个维度进行逐项打分，输出评分结果。并在以下各篇文章的基础上博采众长，综合整理一篇更全面的文章。`,\r\n      layoutDialogVisible: false,\r\n      layoutPrompt: \"\",\r\n      currentLayoutResult: null, // 当前要排版的结果\r\n      historyDrawerVisible: false,\r\n      chatHistory: [],\r\n      pushOfficeNum: 0, // 投递到公众号的递增编号\r\n      pushingToWechat: false, // 投递到公众号的loading状态\r\n    };\r\n  },\r\n  computed: {\r\n    canSend() {\r\n      return (\r\n        this.promptInput.trim().length > 0 &&\r\n        this.aiList.some((ai) => ai.enabled)\r\n      );\r\n    },\r\n    canScore() {\r\n      return (\r\n        this.selectedResults.length > 0 && this.scorePrompt.trim().length > 0\r\n      );\r\n    },\r\n    canLayout() {\r\n      return this.layoutPrompt.trim().length > 0;\r\n    },\r\n    groupedHistory() {\r\n      const groups = {};\r\n      const chatGroups = {};\r\n\r\n      // 首先按chatId分组\r\n      this.chatHistory.forEach((item) => {\r\n        if (!chatGroups[item.chatId]) {\r\n          chatGroups[item.chatId] = [];\r\n        }\r\n        chatGroups[item.chatId].push(item);\r\n      });\r\n\r\n      // 然后按日期分组，并处理父子关系\r\n      Object.values(chatGroups).forEach((chatGroup) => {\r\n        // 按时间排序\r\n        chatGroup.sort(\r\n          (a, b) => new Date(a.createTime) - new Date(b.createTime)\r\n        );\r\n\r\n        // 获取最早的记录作为父级\r\n        const parentItem = chatGroup[0];\r\n        const date = this.getHistoryDate(parentItem.createTime);\r\n\r\n        if (!groups[date]) {\r\n          groups[date] = [];\r\n        }\r\n\r\n        // 添加父级记录\r\n        groups[date].push({\r\n          ...parentItem,\r\n          isParent: true,\r\n          isExpanded: this.expandedHistoryItems[parentItem.chatId] || false,\r\n          children: chatGroup.slice(1).map((child) => ({\r\n            ...child,\r\n            isParent: false,\r\n          })),\r\n        });\r\n      });\r\n\r\n      return groups;\r\n    },\r\n  },\r\n  created() {\r\n    console.log(this.userId);\r\n    console.log(this.corpId);\r\n    this.initWebSocket(this.userId);\r\n    this.loadChatHistory(0); // 加载历史记录\r\n    this.loadLastChat(); // 加载上次会话\r\n  },\r\n  methods: {\r\n    sendPrompt() {\r\n      if (!this.canSend) return;\r\n\r\n      this.screenshots = [];\r\n      // 折叠所有区域\r\n      this.activeCollapses = [];\r\n\r\n      this.taskStarted = true;\r\n      this.results = []; // 清空之前的结果\r\n\r\n      this.userInfoReq.roles = \"\";\r\n\r\n      this.userInfoReq.taskId = uuidv4();\r\n      this.userInfoReq.userId = this.userId;\r\n      this.userInfoReq.corpId = this.corpId;\r\n      this.userInfoReq.userPrompt = this.promptInput;\r\n\r\n      // 获取启用的AI列表及其状态\r\n      this.enabledAIs = this.aiList.filter((ai) => ai.enabled);\r\n\r\n      // 将所有启用的AI状态设置为运行中\r\n      this.enabledAIs.forEach((ai) => {\r\n        this.$set(ai, \"status\", \"running\");\r\n      });\r\n\r\n      this.enabledAIs.forEach(ai => {\r\n        if(ai.name === 'DeepSeek' && ai.enabled){\r\n          this.userInfoReq.roles = this.userInfoReq.roles + 'deepseek,';\r\n          if (ai.selectedCapabilities.includes(\"deep_thinking\")) {\r\n            this.userInfoReq.roles = this.userInfoReq.roles + \"ds-sdsk,\";\r\n          }\r\n          if (ai.selectedCapabilities.includes(\"web_search\")) {\r\n            this.userInfoReq.roles = this.userInfoReq.roles + \"ds-lwss,\";\r\n          }\r\n        }\r\n        if(ai.name === '知乎直答'){\r\n          this.userInfoReq.roles = this.userInfoReq.roles + 'zhihu,';\r\n          if(ai.selectedCapabilities.includes(\"deep_thinking\")){\r\n            this.userInfoReq.roles = this.userInfoReq.roles + 'zhihu-sdsk,';\r\n          }\r\n        }\r\n        if (ai.name === \"豆包\") {\r\n          this.userInfoReq.roles = this.userInfoReq.roles + \"zj-db,\";\r\n          if (ai.selectedCapabilities.includes(\"deep_thinking\")) {\r\n            this.userInfoReq.roles = this.userInfoReq.roles + \"zj-db-sdsk,\";\r\n          }\r\n        }\r\n        if (ai.name === \"MiniMax Chat\") {\r\n          this.userInfoReq.roles = this.userInfoReq.roles + \"mini-max-agent,\";\r\n          if (ai.selectedCapabilities.includes(\"deep_thinking\")) {\r\n            this.userInfoReq.roles = this.userInfoReq.roles + \"max-sdsk,\";\r\n          }\r\n          if (ai.selectedCapabilities.includes(\"web_search\")) {\r\n            this.userInfoReq.roles = this.userInfoReq.roles + \"max-lwss,\";\r\n          }\r\n        }\r\n      });\r\n\r\n      console.log(\"参数：\", this.userInfoReq);\r\n\r\n      //调用后端接口\r\n      this.jsonRpcReqest.method = \"使用F8S\";\r\n      this.jsonRpcReqest.params = this.userInfoReq;\r\n      this.message(this.jsonRpcReqest);\r\n      this.userInfoReq.isNewChat = false;\r\n    },\r\n\r\n    message(data) {\r\n      message(data).then((res) => {\r\n        if (res.code == 201) {\r\n          uni.showToast({\r\n            title: res.messages,\r\n            icon: \"none\",\r\n            duration: 1500,\r\n          });\r\n        }\r\n      });\r\n    },\r\n    toggleCapability(ai, capabilityValue) {\r\n      if (!ai.enabled) return;\r\n\r\n      const index = ai.selectedCapabilities.indexOf(capabilityValue);\r\n      console.log(\"切换前:\", ai.selectedCapabilities);\r\n      if (index === -1) {\r\n        // 如果不存在，则添加\r\n        this.$set(\r\n          ai.selectedCapabilities,\r\n          ai.selectedCapabilities.length,\r\n          capabilityValue\r\n        );\r\n      } else {\r\n        // 如果已存在，则移除\r\n        const newCapabilities = [...ai.selectedCapabilities];\r\n        newCapabilities.splice(index, 1);\r\n        this.$set(ai, \"selectedCapabilities\", newCapabilities);\r\n      }\r\n      console.log(\"切换后:\", ai.selectedCapabilities);\r\n      this.$forceUpdate(); // 强制更新视图\r\n    },\r\n    getStatusText(status) {\r\n      switch (status) {\r\n        case \"idle\":\r\n          return \"等待中\";\r\n        case \"running\":\r\n          return \"正在执行\";\r\n        case \"completed\":\r\n          return \"已完成\";\r\n        case \"failed\":\r\n          return \"执行失败\";\r\n        default:\r\n          return \"未知状态\";\r\n      }\r\n    },\r\n    getStatusIcon(status) {\r\n      switch (status) {\r\n        case \"idle\":\r\n          return \"el-icon-time\";\r\n        case \"running\":\r\n          return \"el-icon-loading\";\r\n        case \"completed\":\r\n          return \"el-icon-check success-icon\";\r\n        case \"failed\":\r\n          return \"el-icon-close error-icon\";\r\n        default:\r\n          return \"el-icon-question\";\r\n      }\r\n    },\r\n    renderMarkdown(text) {\r\n      return marked(text);\r\n    },\r\n    // HTML转纯文本\r\n    htmlToText(html) {\r\n      const tempDiv = document.createElement(\"div\");\r\n      tempDiv.innerHTML = html;\r\n      return tempDiv.textContent || tempDiv.innerText || \"\";\r\n    },\r\n\r\n    // HTML转Markdown\r\n    htmlToMarkdown(html) {\r\n      return this.turndownService.turndown(html);\r\n    },\r\n\r\n    copyResult(content) {\r\n      // 将HTML转换为纯文本\r\n      const plainText = this.htmlToText(content);\r\n      const textarea = document.createElement(\"textarea\");\r\n      textarea.value = plainText;\r\n      document.body.appendChild(textarea);\r\n      textarea.select();\r\n      document.execCommand(\"copy\");\r\n      document.body.removeChild(textarea);\r\n      this.$message.success(\"已复制纯文本到剪贴板\");\r\n    },\r\n\r\n    exportResult(result) {\r\n      // 将HTML转换为Markdown\r\n      const markdown = result.content;\r\n      const blob = new Blob([markdown], { type: \"text/markdown\" });\r\n      const link = document.createElement(\"a\");\r\n      link.href = URL.createObjectURL(blob);\r\n      link.download = `${result.aiName}_结果_${new Date()\r\n        .toISOString()\r\n        .slice(0, 10)}.md`;\r\n      link.click();\r\n      URL.revokeObjectURL(link.href);\r\n      this.$message.success(\"已导出Markdown文件\");\r\n    },\r\n\r\n    openShareUrl(shareUrl) {\r\n      if (shareUrl) {\r\n        window.open(shareUrl, \"_blank\");\r\n      } else {\r\n        this.$message.warning(\"暂无原链接\");\r\n      }\r\n    },\r\n    showLargeImage(imageUrl) {\r\n      this.currentLargeImage = imageUrl;\r\n      this.showImageDialog = true;\r\n      // 找到当前图片的索引，设置轮播图的初始位置\r\n      const currentIndex = this.screenshots.indexOf(imageUrl);\r\n      if (currentIndex !== -1) {\r\n        this.$nextTick(() => {\r\n          const carousel = this.$el.querySelector(\".image-dialog .el-carousel\");\r\n          if (carousel && carousel.__vue__) {\r\n            carousel.__vue__.setActiveItem(currentIndex);\r\n          }\r\n        });\r\n      }\r\n    },\r\n    closeLargeImage() {\r\n      this.showImageDialog = false;\r\n      this.currentLargeImage = \"\";\r\n    },\r\n    // WebSocket 相关方法\r\n    initWebSocket(id) {\r\n      const wsUrl = process.env.VUE_APP_WS_API + `mypc-${id}`;\r\n      console.log(\"WebSocket URL:\", process.env.VUE_APP_WS_API);\r\n      websocketClient.connect(wsUrl, (event) => {\r\n        switch (event.type) {\r\n          case \"open\":\r\n            // this.$message.success('');\r\n            break;\r\n          case \"message\":\r\n            this.handleWebSocketMessage(event.data);\r\n            break;\r\n          case \"close\":\r\n            this.$message.warning(\"WebSocket连接已关闭\");\r\n            break;\r\n          case \"error\":\r\n            this.$message.error(\"WebSocket连接错误\");\r\n            break;\r\n          case \"reconnect_failed\":\r\n            this.$message.error(\"WebSocket重连失败，请刷新页面重试\");\r\n            break;\r\n        }\r\n      });\r\n    },\r\n\r\n    handleWebSocketMessage(data) {\r\n      const datastr = data;\r\n      const dataObj = JSON.parse(datastr);\r\n\r\n      // 处理chatId消息\r\n      if (dataObj.type === \"RETURN_YBT1_CHATID\" && dataObj.chatId) {\r\n        this.userInfoReq.toneChatId = dataObj.chatId;\r\n      } else if (dataObj.type === \"RETURN_YBDS_CHATID\" && dataObj.chatId) {\r\n        this.userInfoReq.ybDsChatId = dataObj.chatId;\r\n      } else if (dataObj.type === \"RETURN_DB_CHATID\" && dataObj.chatId) {\r\n        this.userInfoReq.dbChatId = dataObj.chatId;\r\n      } else if (dataObj.type === \"RETURN_MAX_CHATID\" && dataObj.chatId) {\r\n        this.userInfoReq.maxChatId = dataObj.chatId;\r\n      } else if (dataObj.type === 'RETURN_ZH_CHATID' && dataObj.chatId) {\r\n        this.userInfoReq.zhChatId = dataObj.chatId;\r\n      }\r\n\r\n      // 处理进度日志消息\r\n      if (dataObj.type === \"RETURN_PC_TASK_LOG\" && dataObj.aiName) {\r\n        const targetAI = this.enabledAIs.find(\r\n          (ai) => ai.name === dataObj.aiName\r\n        );\r\n        if (targetAI) {\r\n          // 将新进度添加到数组开头\r\n          targetAI.progressLogs.unshift({\r\n            content: dataObj.content,\r\n            timestamp: new Date(),\r\n            isCompleted: false,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 处理截图消息\r\n      if (dataObj.type === \"RETURN_PC_TASK_IMG\" && dataObj.url) {\r\n        // 将新的截图添加到数组开头\r\n        this.screenshots.unshift(dataObj.url);\r\n        return;\r\n      }\r\n\r\n      // 处理智能评分结果\r\n      if (dataObj.type === \"RETURN_WKPF_RES\") {\r\n        const wkpfAI = this.enabledAIs.find((ai) => ai.name === \"智能评分\");\r\n        if (wkpfAI) {\r\n          this.$set(wkpfAI, \"status\", \"completed\");\r\n          if (wkpfAI.progressLogs.length > 0) {\r\n            this.$set(wkpfAI.progressLogs[0], \"isCompleted\", true);\r\n          }\r\n          // 添加评分结果到results最前面\r\n          this.results.unshift({\r\n            aiName: \"智能评分\",\r\n            content: dataObj.draftContent,\r\n            shareUrl: dataObj.shareUrl || \"\",\r\n            shareImgUrl: dataObj.shareImgUrl || \"\",\r\n            timestamp: new Date(),\r\n          });\r\n          this.activeResultTab = \"result-0\";\r\n\r\n          // 智能评分完成时，再次保存历史记录\r\n          this.saveHistory();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 处理智能排版结果\r\n      if (dataObj.type === \"RETURN_ZNPB_RES\") {\r\n        const znpbAI = this.enabledAIs.find((ai) => ai.name === \"智能排版\");\r\n        if (znpbAI) {\r\n          this.$set(znpbAI, \"status\", \"completed\");\r\n          if (znpbAI.progressLogs.length > 0) {\r\n            this.$set(znpbAI.progressLogs[0], \"isCompleted\", true);\r\n          }\r\n\r\n          // 直接调用投递到公众号的方法，不添加到结果展示\r\n          this.pushToWechatWithContent(dataObj.draftContent);\r\n\r\n          // 智能排版完成时，保存历史记录\r\n          this.saveHistory();\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 根据消息类型更新对应AI的状态和结果\r\n      let targetAI = null;\r\n      switch (dataObj.type) {\r\n        case 'RETURN_ZH_RES':\r\n          console.log('收到知乎直答消息:',data);\r\n          targetAI = this.enabledAIs.find(ai => ai.name === '知乎直答');\r\n          break;\r\n        case 'RETURN_YBT1_RES':\r\n        case 'RETURN_TURBOS_RES':\r\n        case 'RETURN_TURBOS_LARGE_RES':\r\n        case 'RETURN_DEEPSEEK_RES':\r\n          console.log('收到DeepSeek消息:', dataObj);\r\n          targetAI = this.enabledAIs.find(ai => ai.name === 'DeepSeek');\r\n          break;\r\n        case \"RETURN_DB_RES\":\r\n          console.log(\"收到豆包消息:\", dataObj);\r\n          targetAI = this.enabledAIs.find((ai) => ai.name === \"豆包\");\r\n          break;\r\n        case \"RETURN_MAX_RES\":\r\n          console.log(\"收到MiniMax消息:\", dataObj);\r\n          targetAI = this.enabledAIs.find((ai) => ai.name === \"MiniMax Chat\");\r\n          break;\r\n      }\r\n\r\n      if (targetAI) {\r\n        // 更新AI状态为已完成\r\n        this.$set(targetAI, \"status\", \"completed\");\r\n\r\n        // 将最后一条进度消息标记为已完成\r\n        if (targetAI.progressLogs.length > 0) {\r\n          this.$set(targetAI.progressLogs[0], \"isCompleted\", true);\r\n        }\r\n\r\n        // 添加结果到数组开头\r\n        const resultIndex = this.results.findIndex(\r\n          (r) => r.aiName === targetAI.name\r\n        );\r\n        if (resultIndex === -1) {\r\n          this.results.unshift({\r\n            aiName: targetAI.name,\r\n            content: dataObj.draftContent,\r\n            shareUrl: dataObj.shareUrl || \"\",\r\n            shareImgUrl: dataObj.shareImgUrl || \"\",\r\n            timestamp: new Date(),\r\n          });\r\n          this.activeResultTab = \"result-0\";\r\n        } else {\r\n          this.results.splice(resultIndex, 1);\r\n          this.results.unshift({\r\n            aiName: targetAI.name,\r\n            content: dataObj.draftContent,\r\n            shareUrl: dataObj.shareUrl || \"\",\r\n            shareImgUrl: dataObj.shareImgUrl || \"\",\r\n            timestamp: new Date(),\r\n          });\r\n          this.activeResultTab = \"result-0\";\r\n        }\r\n        this.saveHistory();\r\n      }\r\n\r\n      // 检查是否所有任务都已完成\r\n      // const allCompleted = this.enabledAIs.every(ai =>\r\n      //   ai.status === 'completed' || ai.status === 'failed'\r\n      // );\r\n\r\n      // if (allCompleted) {\r\n      //\r\n      // }\r\n    },\r\n\r\n    closeWebSocket() {\r\n      websocketClient.close();\r\n    },\r\n\r\n    sendMessage(data) {\r\n      if (websocketClient.send(data)) {\r\n        // 滚动到底部\r\n        this.$nextTick(() => {\r\n          this.scrollToBottom();\r\n        });\r\n      } else {\r\n        this.$message.error(\"WebSocket未连接\");\r\n      }\r\n    },\r\n    toggleAIExpansion(ai) {\r\n      this.$set(ai, \"isExpanded\", !ai.isExpanded);\r\n    },\r\n\r\n    formatTime(timestamp) {\r\n      const date = new Date(timestamp);\r\n      return date.toLocaleTimeString(\"zh-CN\", {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n        second: \"2-digit\",\r\n        hour12: false,\r\n      });\r\n    },\r\n    showScoreDialog() {\r\n      this.scoreDialogVisible = true;\r\n      this.selectedResults = [];\r\n    },\r\n\r\n    handleScore() {\r\n      if (!this.canScore) return;\r\n\r\n      // 获取选中的结果内容并按照指定格式拼接\r\n      const selectedContents = this.results\r\n        .filter((result) => this.selectedResults.includes(result.aiName))\r\n        .map((result) => {\r\n          // 将HTML内容转换为纯文本\r\n          const plainContent = this.htmlToText(result.content);\r\n          return `${result.aiName}初稿：\\n${plainContent}\\n`;\r\n        })\r\n        .join(\"\\n\");\r\n\r\n      // 构建完整的评分提示内容\r\n      const fullPrompt = `${this.scorePrompt}\\n${selectedContents}`;\r\n\r\n      // 构建评分请求\r\n      const scoreRequest = {\r\n        jsonrpc: \"2.0\",\r\n        id: uuidv4(),\r\n        method: \"AI评分\",\r\n        params: {\r\n          taskId: uuidv4(),\r\n          userId: this.userId,\r\n          corpId: this.corpId,\r\n          userPrompt: fullPrompt,\r\n          roles: \"zj-db-sdsk\", // 默认使用豆包进行评分\r\n        },\r\n      };\r\n\r\n      // 发送评分请求\r\n      console.log(\"参数\", scoreRequest);\r\n      this.message(scoreRequest);\r\n      this.scoreDialogVisible = false;\r\n\r\n      // 创建智能评分AI节点\r\n      const wkpfAI = {\r\n        name: \"智能评分\",\r\n        avatar: require(\"../../../assets/ai/yuanbao.png\"),\r\n        capabilities: [],\r\n        selectedCapabilities: [],\r\n        enabled: true,\r\n        status: \"running\",\r\n        progressLogs: [\r\n          {\r\n            content: \"智能评分任务已提交，正在评分...\",\r\n            timestamp: new Date(),\r\n            isCompleted: false,\r\n            type: \"智能评分\",\r\n          },\r\n        ],\r\n        isExpanded: true,\r\n      };\r\n\r\n      // 检查是否已存在智能评分\r\n      const existIndex = this.enabledAIs.findIndex(\r\n        (ai) => ai.name === \"智能评分\"\r\n      );\r\n      if (existIndex === -1) {\r\n        // 如果不存在，添加到数组开头\r\n        this.enabledAIs.unshift(wkpfAI);\r\n      } else {\r\n        // 如果已存在，更新状态和日志\r\n        this.enabledAIs[existIndex] = wkpfAI;\r\n        // 将智能评分移到数组开头\r\n        const wkpf = this.enabledAIs.splice(existIndex, 1)[0];\r\n        this.enabledAIs.unshift(wkpf);\r\n      }\r\n\r\n      this.$forceUpdate();\r\n      this.$message.success(\"评分请求已发送，请等待结果\");\r\n    },\r\n    // 显示历史记录抽屉\r\n    showHistoryDrawer() {\r\n      this.historyDrawerVisible = true;\r\n      this.loadChatHistory(1);\r\n    },\r\n\r\n    // 关闭历史记录抽屉\r\n    handleHistoryDrawerClose() {\r\n      this.historyDrawerVisible = false;\r\n    },\r\n\r\n    // 加载历史记录\r\n    async loadChatHistory(isAll) {\r\n      try {\r\n        const res = await getChatHistory(this.userId, isAll);\r\n        if (res.code === 200) {\r\n          this.chatHistory = res.data || [];\r\n        }\r\n      } catch (error) {\r\n        console.error(\"加载历史记录失败:\", error);\r\n        this.$message.error(\"加载历史记录失败\");\r\n      }\r\n    },\r\n\r\n    // 格式化历史记录时间\r\n    formatHistoryTime(timestamp) {\r\n      const date = new Date(timestamp);\r\n      return date.toLocaleTimeString(\"zh-CN\", {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n        hour12: false,\r\n      });\r\n    },\r\n\r\n    // 获取历史记录日期分组\r\n    getHistoryDate(timestamp) {\r\n      const date = new Date(timestamp);\r\n      const today = new Date();\r\n      const yesterday = new Date(today);\r\n      yesterday.setDate(yesterday.getDate() - 1);\r\n      const twoDaysAgo = new Date(today);\r\n      twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);\r\n      const threeDaysAgo = new Date(today);\r\n      threeDaysAgo.setDate(threeDaysAgo.getDate() - 3);\r\n\r\n      if (date.toDateString() === today.toDateString()) {\r\n        return \"今天\";\r\n      } else if (date.toDateString() === yesterday.toDateString()) {\r\n        return \"昨天\";\r\n      } else if (date.toDateString() === twoDaysAgo.toDateString()) {\r\n        return \"两天前\";\r\n      } else if (date.toDateString() === threeDaysAgo.toDateString()) {\r\n        return \"三天前\";\r\n      } else {\r\n        return date.toLocaleDateString(\"zh-CN\", {\r\n          year: \"numeric\",\r\n          month: \"long\",\r\n          day: \"numeric\",\r\n        });\r\n      }\r\n    },\r\n\r\n    // 加载历史记录项\r\n    loadHistoryItem(item) {\r\n      try {\r\n        const historyData = JSON.parse(item.data);\r\n        \r\n        // 恢复AI选择配置，但重新设置知乎直答的图标路径\r\n        if (historyData.aiList) {\r\n          const updatedAiList = historyData.aiList.map(ai => {\r\n            if (ai.name === '知乎直答') {\r\n              return { ...ai, avatar: require('../../../assets/ai/zhihu.png') };\r\n            }\r\n            return ai;\r\n          });\r\n          this.aiList = updatedAiList;\r\n        } else {\r\n          this.aiList = this.aiList;\r\n        }\r\n        \r\n        // 恢复提示词输入\r\n        this.promptInput = historyData.promptInput || \"\";\r\n        // 恢复任务流程\r\n        this.enabledAIs = historyData.enabledAIs || [];\r\n        // 恢复主机可视化\r\n        this.screenshots = historyData.screenshots || [];\r\n        // 恢复执行结果\r\n        this.results = historyData.results || [];\r\n        // 恢复chatId\r\n        this.chatId = item.chatId || this.chatId;\r\n        this.userInfoReq.toneChatId = item.toneChatId || '';\r\n        this.userInfoReq.ybDsChatId = item.ybDsChatId || '';\r\n        this.userInfoReq.dbChatId = item.dbChatId || '';\r\n        this.userInfoReq.zhChatId = item.zhChatId || '';\r\n        this.userInfoReq.maxChatId = item.maxChatId || \"\";\r\n        this.userInfoReq.isNewChat = false;\r\n\r\n        // 展开相关区域\r\n        this.activeCollapses = [\"ai-selection\", \"prompt-input\"];\r\n        this.taskStarted = true;\r\n\r\n        this.$message.success(\"历史记录加载成功\");\r\n        this.historyDrawerVisible = false;\r\n      } catch (error) {\r\n        console.error(\"加载历史记录失败:\", error);\r\n        this.$message.error(\"加载历史记录失败\");\r\n      }\r\n    },\r\n\r\n    // 保存历史记录\r\n    async saveHistory() {\r\n      // if (!this.taskStarted || this.enabledAIs.some(ai => ai.status === 'running')) {\r\n      //   return;\r\n      // }\r\n\r\n      const historyData = {\r\n        aiList: this.aiList,\r\n        promptInput: this.promptInput,\r\n        enabledAIs: this.enabledAIs,\r\n        screenshots: this.screenshots,\r\n        results: this.results,\r\n        chatId: this.chatId,\r\n        toneChatId: this.userInfoReq.toneChatId,\r\n        ybDsChatId: this.userInfoReq.ybDsChatId,\r\n        dbChatId: this.userInfoReq.dbChatId,\r\n        zhChatId: this.userInfoReq.zhChatId,\r\n        maxChatId: this.userInfoReq.maxChatId,\r\n      };\r\n\r\n      try {\r\n        await saveUserChatData({\r\n          userId: this.userId,\r\n          userPrompt: this.promptInput,\r\n          data: JSON.stringify(historyData),\r\n          chatId: this.chatId,\r\n          toneChatId: this.userInfoReq.toneChatId,\r\n          ybDsChatId: this.userInfoReq.ybDsChatId,\r\n          dbChatId: this.userInfoReq.dbChatId,\r\n          zhChatId: this.userInfoReq.zhChatId,\r\n          maxChatId: this.userInfoReq.maxChatId,\r\n        });\r\n      } catch (error) {\r\n        console.error(\"保存历史记录失败:\", error);\r\n        this.$message.error(\"保存历史记录失败\");\r\n      }\r\n    },\r\n\r\n    // 修改折叠切换方法\r\n    toggleHistoryExpansion(item) {\r\n      this.$set(\r\n        this.expandedHistoryItems,\r\n        item.chatId,\r\n        !this.expandedHistoryItems[item.chatId]\r\n      );\r\n    },\r\n\r\n    // 创建新对话\r\n    createNewChat() {\r\n      // 重置所有数据\r\n      this.chatId = uuidv4();\r\n      this.isNewChat = true;\r\n      this.promptInput = \"\";\r\n      this.taskStarted = false;\r\n      this.screenshots = [];\r\n      this.results = [];\r\n      this.enabledAIs = [];\r\n      this.userInfoReq = {\r\n        userPrompt: \"\",\r\n        userId: this.userId,\r\n        corpId: this.corpId,\r\n        taskId: '',\r\n        roles: '',\r\n        toneChatId: '',\r\n        ybDsChatId: '',\r\n        dbChatId: '',\r\n        zhChatId: '',\r\n        maxChatId: '',\r\n        isNewChat: true\r\n      };\r\n      // 重置AI列表为初始状态\r\n      this.aiList = [\r\n        {\r\n          name: 'DeepSeek',\r\n          avatar: require('../../../assets/logo/Deepseek.png'),\r\n          capabilities: [\r\n            { label: \"深度思考\", value: \"deep_thinking\" },\r\n            { label: \"联网搜索\", value: \"web_search\" },\r\n          ],\r\n          selectedCapabilities: ['deep_thinking', 'web_search'],\r\n          enabled: true,\r\n          status: \"idle\",\r\n          progressLogs: [],\r\n          isExpanded: true,\r\n        },\r\n        {\r\n          name: '知乎直答',\r\n          avatar: require('../../../assets/ai/zhihu.png'),\r\n          capabilities: [\r\n            { label: '深度思考', value: 'deep_thinking' }\r\n          ],\r\n          selectedCapabilities: ['deep_thinking'],\r\n          enabled: true,\r\n          status: 'idle',\r\n          progressLogs: [],\r\n          isExpanded: true\r\n        },\r\n        {\r\n          name: \"MiniMax Chat\",\r\n          avatar: require(\"../../../assets/ai/MiniMax.png\"),\r\n          capabilities: [\r\n            { label: \"深度思考\", value: \"deep_thinking\" },\r\n            { label: \"联网\", value: \"web_search\" },\r\n          ],\r\n          selectedCapabilities: [\"deep_thinking\", \"web_search\"],\r\n          enabled: true,\r\n          status: \"idle\",\r\n          progressLogs: [],\r\n          isExpanded: true,\r\n        },\r\n        {\r\n          name: '豆包',\r\n          avatar: require('../../../assets/ai/豆包.png'),\r\n          capabilities: [\r\n            { label: '深度思考', value: 'deep_thinking' }\r\n          ],\r\n          selectedCapabilities: ['deep_thinking'],\r\n          enabled: true,\r\n          status: 'idle',\r\n          progressLogs: [],\r\n          isExpanded: true\r\n        }\r\n      ];\r\n      // 展开相关区域\r\n      this.activeCollapses = [\"ai-selection\", \"prompt-input\"];\r\n\r\n      this.$message.success(\"已创建新对话\");\r\n    },\r\n\r\n    // 加载上次会话\r\n    async loadLastChat() {\r\n      try {\r\n        const res = await getChatHistory(this.userId, 0);\r\n        if (res.code === 200 && res.data && res.data.length > 0) {\r\n          // 获取最新的会话记录\r\n          const lastChat = res.data[0];\r\n          this.loadHistoryItem(lastChat);\r\n        }\r\n      } catch (error) {\r\n        console.error(\"加载上次会话失败:\", error);\r\n      }\r\n    },\r\n\r\n    // 判断是否为图片文件\r\n    isImageFile(url) {\r\n      if (!url) return false;\r\n      const imageExtensions = [\r\n        \".jpg\",\r\n        \".jpeg\",\r\n        \".png\",\r\n        \".gif\",\r\n        \".bmp\",\r\n        \".webp\",\r\n        \".svg\",\r\n      ];\r\n      const urlLower = url.toLowerCase();\r\n      return imageExtensions.some((ext) => urlLower.includes(ext));\r\n    },\r\n\r\n    // 判断是否为PDF文件\r\n    isPdfFile(url) {\r\n      if (!url) return false;\r\n      return url.toLowerCase().includes(\".pdf\");\r\n    },\r\n\r\n    // 根据AI名称获取图片样式\r\n    getImageStyle(aiName) {\r\n      const widthMap = {\r\n        DeepSeek: \"700px\",\r\n        豆包: \"560px\",\r\n      };\r\n\r\n      const width = widthMap[aiName] || \"560px\"; // 默认宽度\r\n\r\n      return {\r\n        width: width,\r\n        height: \"auto\",\r\n      };\r\n    },\r\n\r\n    // 投递到公众号\r\n    handlePushToWechat(result) {\r\n      this.showLayoutDialog(result);\r\n    },\r\n\r\n    // 显示智能排版对话框\r\n    showLayoutDialog(result) {\r\n      this.currentLayoutResult = result;\r\n      this.layoutPrompt =\r\n        `请你对以下 HTML 内容进行排版优化，目标是用于微信公众号\"草稿箱接口\"的 content 字段，要求如下：\r\n\r\n1. 仅返回 <body> 内部可用的 HTML 内容片段（不要包含 <!DOCTYPE>、<html>、<head>、<meta>、<title> 等标签）。\r\n2. 所有样式必须以\"内联 style\"方式写入。\r\n3. 保持结构清晰、视觉友好，适配公众号图文排版。\r\n4. 请直接输出代码，不要添加任何注释或额外说明。\r\n5. 不得使用 emoji 表情符号或小图标字符。\r\n6. 不要显示为问答形式，以一篇文章的格式去调整 \\n\\n以下为需要进行排版优化的内容：\\n` +\r\n        result.content;\r\n      this.layoutDialogVisible = true;\r\n    },\r\n\r\n    // 处理智能排版\r\n    handleLayout() {\r\n      if (!this.canLayout || !this.currentLayoutResult) return;\r\n\r\n      // 构建排版请求\r\n      const layoutRequest = {\r\n        jsonrpc: \"2.0\",\r\n        id: uuidv4(),\r\n        method: \"AI排版\",\r\n        params: {\r\n          taskId: uuidv4(),\r\n          userId: this.userId,\r\n          corpId: this.corpId,\r\n          userPrompt: this.layoutPrompt,\r\n          roles: \"\", // 默认使用豆包进行排版\r\n        },\r\n      };\r\n\r\n      // 发送排版请求\r\n      console.log(\"排版参数\", layoutRequest);\r\n      this.message(layoutRequest);\r\n      this.layoutDialogVisible = false;\r\n\r\n      // 创建智能排版AI节点\r\n      const znpbAI = {\r\n        name: \"智能排版\",\r\n        avatar: require(\"../../../assets/ai/yuanbao.png\"),\r\n        capabilities: [],\r\n        selectedCapabilities: [],\r\n        enabled: true,\r\n        status: \"running\",\r\n        progressLogs: [\r\n          {\r\n            content: \"智能排版任务已提交，正在排版...\",\r\n            timestamp: new Date(),\r\n            isCompleted: false,\r\n            type: \"智能排版\",\r\n          },\r\n        ],\r\n        isExpanded: true,\r\n      };\r\n\r\n      // 检查是否已存在智能排版\r\n      const existIndex = this.enabledAIs.findIndex(\r\n        (ai) => ai.name === \"智能排版\"\r\n      );\r\n      if (existIndex === -1) {\r\n        // 如果不存在，添加到数组开头\r\n        this.enabledAIs.unshift(znpbAI);\r\n      } else {\r\n        // 如果已存在，更新状态和日志\r\n        this.enabledAIs[existIndex] = znpbAI;\r\n        // 将智能排版移到数组开头\r\n        const znpb = this.enabledAIs.splice(existIndex, 1)[0];\r\n        this.enabledAIs.unshift(znpb);\r\n      }\r\n\r\n      this.$forceUpdate();\r\n      this.$message.success(\"排版请求已发送，请等待结果\");\r\n    },\r\n\r\n    // 实际投递到公众号\r\n    pushToWechatWithContent(contentText) {\r\n      if (this.pushingToWechat) return;\r\n      this.$message.success(\"开始投递公众号！\");\r\n      this.pushingToWechat = true;\r\n      this.pushOfficeNum += 1;\r\n\r\n      const params = {\r\n        contentText: contentText,\r\n        shareUrl: this.currentLayoutResult.shareUrl,\r\n        userId: this.userId,\r\n        num: this.pushOfficeNum,\r\n        aiName: this.currentLayoutResult.aiName,\r\n      };\r\n\r\n      pushAutoOffice(params)\r\n        .then((res) => {\r\n          if (res.code === 200) {\r\n            this.$message.success(\"投递到公众号成功！\");\r\n          } else {\r\n            this.$message.error(res.msg || \"投递失败，请重试\");\r\n          }\r\n        })\r\n        .catch((error) => {\r\n          console.error(\"投递到公众号失败:\", error);\r\n          this.$message.error(\"投递失败，请重试\");\r\n        })\r\n        .finally(() => {\r\n          this.pushingToWechat = false;\r\n        });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.ai-management-platform {\r\n  min-height: 100vh;\r\n  background-color: #f5f7fa;\r\n  padding-bottom: 30px;\r\n}\r\n\r\n.top-nav {\r\n  background-color: #fff;\r\n  padding: 15px 20px;\r\n  box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);\r\n  margin-bottom: 20px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.logo-area {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.logo {\r\n  height: 36px;\r\n  margin-right: 10px;\r\n}\r\n\r\n.platform-title {\r\n  margin: 0;\r\n  font-size: 20px;\r\n  color: #303133;\r\n}\r\n\r\n.main-content {\r\n  padding: 0 30px;\r\n  width: 90%;\r\n  margin: 0 auto;\r\n}\r\n::v-deep .el-collapse-item__header {\r\n  font-size: 16px;\r\n  color: #333;\r\n  padding-left: 20px;\r\n}\r\n.section-title {\r\n  font-size: 18px;\r\n  color: #606266;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.ai-cards {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 20px;\r\n  margin-bottom: 0px;\r\n  margin-left: 20px;\r\n  margin-top: 10px;\r\n}\r\n\r\n.ai-card {\r\n  width: calc(25% - 20px);\r\n  box-sizing: border-box;\r\n}\r\n\r\n.ai-card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.ai-left {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.ai-avatar {\r\n  margin-right: 10px;\r\n}\r\n\r\n.ai-avatar img {\r\n  width: 30px;\r\n  height: 30px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n}\r\n\r\n.ai-name {\r\n  font-weight: bold;\r\n  font-size: 12px;\r\n}\r\n\r\n.ai-status {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.ai-capabilities {\r\n  margin: 15px 0;\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  flex-wrap: wrap;\r\n}\r\n\r\n.button-capability-group {\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  justify-content: center;\r\n  gap: 8px;\r\n}\r\n\r\n.button-capability-group .el-button {\r\n  margin: 0;\r\n  border-radius: 16px;\r\n  padding: 6px 12px;\r\n}\r\n\r\n.button-capability-group .el-button.is-plain:hover,\r\n.button-capability-group .el-button.is-plain:focus {\r\n  background: #ecf5ff;\r\n  border-color: #b3d8ff;\r\n  color: #409eff;\r\n}\r\n\r\n.prompt-input-section {\r\n  margin-bottom: 30px;\r\n  padding: 0 20px 0 0px;\r\n}\r\n\r\n.prompt-input {\r\n  margin-bottom: 10px;\r\n  margin-left: 20px;\r\n  width: 99%;\r\n}\r\n\r\n.prompt-footer {\r\n  display: flex;\r\n  margin-bottom: -30px;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.word-count {\r\n  font-size: 12px;\r\n  padding-left: 20px;\r\n}\r\n\r\n.send-button {\r\n  padding: 10px 20px;\r\n}\r\n\r\n.execution-status-section {\r\n  margin-bottom: 30px;\r\n  padding: 20px 0px 0px 0px;\r\n}\r\n\r\n.task-flow-card,\r\n.screenshots-card {\r\n  height: 800px;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.task-flow {\r\n  padding: 15px;\r\n  height: 800px;\r\n  overflow-y: auto;\r\n  background-color: #f5f7fa;\r\n  border-radius: 4px;\r\n}\r\n\r\n.task-flow::-webkit-scrollbar {\r\n  width: 6px;\r\n}\r\n\r\n.task-flow::-webkit-scrollbar-thumb {\r\n  background-color: #c0c4cc;\r\n  border-radius: 3px;\r\n}\r\n\r\n.task-flow::-webkit-scrollbar-track {\r\n  background-color: #f5f7fa;\r\n}\r\n\r\n.task-item {\r\n  margin-bottom: 15px;\r\n  border-radius: 4px;\r\n  background-color: #fff;\r\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n  overflow: hidden;\r\n}\r\n\r\n.task-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 12px 15px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.task-header:hover {\r\n  background-color: #f5f7fa;\r\n}\r\n\r\n.header-left {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.header-left .el-icon-arrow-right {\r\n  transition: transform 0.3s;\r\n  font-size: 14px;\r\n  color: #909399;\r\n}\r\n\r\n.header-left .el-icon-arrow-right.is-expanded {\r\n  transform: rotate(90deg);\r\n}\r\n\r\n.progress-timeline {\r\n  position: relative;\r\n  margin: 0;\r\n  padding: 15px 0;\r\n}\r\n\r\n.timeline-scroll {\r\n  max-height: 200px;\r\n  overflow-y: auto;\r\n  padding: 0 15px;\r\n}\r\n\r\n.timeline-scroll::-webkit-scrollbar {\r\n  width: 4px;\r\n}\r\n\r\n.timeline-scroll::-webkit-scrollbar-thumb {\r\n  background-color: #c0c4cc;\r\n  border-radius: 2px;\r\n}\r\n\r\n.timeline-scroll::-webkit-scrollbar-track {\r\n  background-color: #f5f7fa;\r\n}\r\n\r\n.progress-item {\r\n  position: relative;\r\n  padding: 8px 0 8px 20px;\r\n  display: flex;\r\n  align-items: flex-start;\r\n  border-bottom: 1px solid #f0f0f0;\r\n}\r\n\r\n.progress-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.progress-dot {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 12px;\r\n  width: 10px;\r\n  height: 10px;\r\n  border-radius: 50%;\r\n  background-color: #e0e0e0;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.progress-line {\r\n  position: absolute;\r\n  left: 4px;\r\n  top: 22px;\r\n  bottom: -8px;\r\n  width: 2px;\r\n  background-color: #e0e0e0;\r\n}\r\n\r\n.progress-content {\r\n  flex: 1;\r\n  min-width: 0;\r\n}\r\n\r\n.progress-time {\r\n  font-size: 12px;\r\n  color: #909399;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.progress-text {\r\n  font-size: 13px;\r\n  color: #606266;\r\n  line-height: 1.4;\r\n  word-break: break-all;\r\n}\r\n\r\n.progress-item.completed .progress-dot {\r\n  background-color: #67c23a;\r\n}\r\n\r\n.progress-item.completed .progress-line {\r\n  background-color: #67c23a;\r\n}\r\n\r\n.progress-item.current .progress-dot {\r\n  background-color: #409eff;\r\n  animation: pulse 1.5s infinite;\r\n}\r\n\r\n.progress-item.current .progress-line {\r\n  background-color: #409eff;\r\n}\r\n\r\n.ai-name {\r\n  font-weight: 600;\r\n  font-size: 14px;\r\n  color: #303133;\r\n}\r\n\r\n.header-right {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n}\r\n\r\n.status-text {\r\n  font-size: 13px;\r\n  color: #606266;\r\n}\r\n\r\n.status-icon {\r\n  font-size: 16px;\r\n}\r\n\r\n.success-icon {\r\n  color: #67c23a;\r\n}\r\n\r\n.error-icon {\r\n  color: #f56c6c;\r\n}\r\n\r\n@keyframes pulse {\r\n  0% {\r\n    box-shadow: 0 0 0 0 rgba(64, 158, 255, 0.4);\r\n  }\r\n  70% {\r\n    box-shadow: 0 0 0 6px rgba(64, 158, 255, 0);\r\n  }\r\n  100% {\r\n    box-shadow: 0 0 0 0 rgba(64, 158, 255, 0);\r\n  }\r\n}\r\n\r\n.screenshot-image {\r\n  width: 100%;\r\n  height: 100%;\r\n  object-fit: contain;\r\n  cursor: pointer;\r\n  transition: transform 0.3s;\r\n}\r\n\r\n.screenshot-image:hover {\r\n  transform: scale(1.05);\r\n}\r\n\r\n.results-section {\r\n  margin-top: 20px;\r\n  padding: 0 10px;\r\n}\r\n\r\n.result-content {\r\n  padding: 20px 30px;\r\n}\r\n\r\n.result-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 15px;\r\n  padding-bottom: 10px;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.result-title {\r\n  font-size: 16px;\r\n  font-weight: 600;\r\n  color: #303133;\r\n}\r\n\r\n.result-buttons {\r\n  display: flex;\r\n  gap: 10px;\r\n  align-items: center;\r\n}\r\n\r\n.share-link-btn,\r\n.push-wechat-btn {\r\n  border-radius: 16px;\r\n  padding: 6px 12px;\r\n}\r\n\r\n.markdown-content {\r\n  margin-bottom: 20px;\r\n  max-height: 400px;\r\n  overflow-y: auto;\r\n  padding: 15px 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  background-color: #fff;\r\n}\r\n\r\n.action-buttons {\r\n  display: flex;\r\n  justify-content: flex-end;\r\n  gap: 10px;\r\n  padding: 0 10px;\r\n}\r\n\r\n@media (max-width: 1200px) {\r\n  .ai-card {\r\n    width: calc(33.33% - 14px);\r\n  }\r\n}\r\n\r\n@media (max-width: 992px) {\r\n  .ai-card {\r\n    width: calc(50% - 10px);\r\n  }\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .ai-card {\r\n    width: 100%;\r\n  }\r\n}\r\n\r\n.el-collapse {\r\n  border-top: none;\r\n  border-bottom: none;\r\n}\r\n\r\n.el-collapse-item__content {\r\n  padding: 15px 0;\r\n}\r\n\r\n.ai-selection-section {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.prompt-input-section {\r\n  margin-bottom: 30px;\r\n  padding: 0 20px 0 0px;\r\n}\r\n\r\n.image-dialog .el-dialog__body {\r\n  padding: 0;\r\n}\r\n\r\n.large-image-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background-color: #000;\r\n}\r\n\r\n.large-image {\r\n  max-width: 100%;\r\n  max-height: 80vh;\r\n  object-fit: contain;\r\n}\r\n\r\n.image-dialog .el-carousel {\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n\r\n.image-dialog .el-carousel__container {\r\n  height: 80vh;\r\n}\r\n\r\n.image-dialog .el-carousel__item {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  background-color: #000;\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 15px;\r\n}\r\n\r\n.score-dialog-content {\r\n  padding: 20px;\r\n}\r\n\r\n.selected-results {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.result-checkbox {\r\n  margin-right: 20px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.score-prompt-section {\r\n  margin-top: 20px;\r\n}\r\n\r\n.score-prompt-input {\r\n  margin-top: 10px;\r\n}\r\n\r\n.score-prompt-input .el-textarea__inner {\r\n  min-height: 500px !important;\r\n}\r\n\r\n.dialog-footer {\r\n  text-align: right;\r\n}\r\n\r\n.score-dialog .el-dialog {\r\n  height: 95vh;\r\n  margin-top: 2.5vh !important;\r\n}\r\n\r\n.score-dialog .el-dialog__body {\r\n  height: calc(95vh - 120px);\r\n  overflow-y: auto;\r\n  padding: 20px;\r\n}\r\n\r\n.layout-dialog-content {\r\n  padding: 20px;\r\n}\r\n\r\n.layout-prompt-section {\r\n  margin-top: 20px;\r\n}\r\n\r\n.layout-prompt-input {\r\n  margin-top: 10px;\r\n}\r\n\r\n.layout-prompt-input .el-textarea__inner {\r\n  min-height: 500px !important;\r\n}\r\n\r\n.layout-dialog .el-dialog {\r\n  height: 95vh;\r\n  margin-top: 2.5vh !important;\r\n}\r\n\r\n.layout-dialog .el-dialog__body {\r\n  height: calc(95vh - 120px);\r\n  overflow-y: auto;\r\n  padding: 20px;\r\n}\r\n\r\n.nav-buttons {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 20px;\r\n}\r\n\r\n.history-button {\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.history-icon {\r\n  width: 24px;\r\n  height: 24px;\r\n  vertical-align: middle;\r\n}\r\n\r\n.history-content {\r\n  padding: 20px;\r\n}\r\n\r\n.history-group {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.history-date {\r\n  font-size: 14px;\r\n  color: #909399;\r\n  margin-bottom: 10px;\r\n  padding: 5px 0;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.history-list {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 10px;\r\n}\r\n\r\n.history-item {\r\n  margin-bottom: 15px;\r\n  border-radius: 4px;\r\n  background-color: #f5f7fa;\r\n  overflow: hidden;\r\n}\r\n\r\n.history-parent {\r\n  padding: 10px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n  border-bottom: 1px solid #ebeef5;\r\n}\r\n\r\n.history-parent:hover {\r\n  background-color: #ecf5ff;\r\n}\r\n\r\n.history-children {\r\n  padding-left: 20px;\r\n  background-color: #fff;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.history-child-item {\r\n  padding: 8px 10px;\r\n  cursor: pointer;\r\n  transition: background-color 0.3s;\r\n  border-bottom: 1px solid #f0f0f0;\r\n}\r\n\r\n.history-child-item:last-child {\r\n  border-bottom: none;\r\n}\r\n\r\n.history-child-item:hover {\r\n  background-color: #f5f7fa;\r\n}\r\n\r\n.history-header {\r\n  display: flex;\r\n  align-items: flex-start;\r\n  gap: 8px;\r\n}\r\n\r\n.history-header .el-icon-arrow-right {\r\n  font-size: 14px;\r\n  color: #909399;\r\n  transition: transform 0.3s;\r\n  cursor: pointer;\r\n  margin-top: 3px;\r\n}\r\n\r\n.history-header .el-icon-arrow-right.is-expanded {\r\n  transform: rotate(90deg);\r\n}\r\n\r\n.history-prompt {\r\n  font-size: 14px;\r\n  color: #303133;\r\n  margin-bottom: 5px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  display: -webkit-box;\r\n  -webkit-line-clamp: 2;\r\n  -webkit-box-orient: vertical;\r\n  flex: 1;\r\n}\r\n\r\n.history-time {\r\n  font-size: 12px;\r\n  color: #909399;\r\n}\r\n\r\n.capability-button {\r\n  transition: all 0.3s;\r\n}\r\n\r\n.capability-button.el-button--primary {\r\n  background-color: #409eff;\r\n  border-color: #409eff;\r\n  color: #fff;\r\n}\r\n\r\n.capability-button.el-button--info {\r\n  background-color: #fff;\r\n  border-color: #dcdfe6;\r\n  color: #606266;\r\n}\r\n\r\n.capability-button.el-button--info:hover {\r\n  color: #409eff;\r\n  border-color: #c6e2ff;\r\n  background-color: #ecf5ff;\r\n}\r\n\r\n.capability-button.el-button--primary:hover {\r\n  background-color: #66b1ff;\r\n  border-color: #66b1ff;\r\n  color: #fff;\r\n}\r\n\r\n/* 分享内容样式 */\r\n.share-content {\r\n  margin-bottom: 20px;\r\n  padding: 15px 20px;\r\n  border: 1px solid #ebeef5;\r\n  border-radius: 4px;\r\n  background-color: #fff;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: flex-start;\r\n  min-height: 600px;\r\n  max-height: 800px;\r\n  overflow: auto;\r\n}\r\n\r\n.share-image {\r\n  object-fit: contain;\r\n  display: block;\r\n}\r\n\r\n.share-pdf {\r\n  width: 100%;\r\n  height: 600px;\r\n  border: none;\r\n  border-radius: 4px;\r\n}\r\n\r\n.share-file {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 200px;\r\n  flex-direction: column;\r\n  color: #909399;\r\n}\r\n\r\n.single-image-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  width: 100%;\r\n  height: 80vh;\r\n}\r\n\r\n.single-image-container .large-image {\r\n  max-width: 100%;\r\n  max-height: 100%;\r\n  object-fit: contain;\r\n}\r\n\r\n/* 用于处理DeepSeek特殊格式的样式 */\r\n.deepseek-format-container {\r\n  margin: 20px 0;\r\n  padding: 15px;\r\n  background-color: #f9f9f9;\r\n  border-radius: 5px;\r\n  border: 1px solid #eaeaea;\r\n}\r\n\r\n/* DeepSeek响应内容的特定样式 */\r\n::v-deep .deepseek-response {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  background-color: #fff;\r\n  border-radius: 8px;\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\r\n  padding: 20px;\r\n  font-family: Arial, sans-serif;\r\n}\r\n\r\n::v-deep .deepseek-response pre {\r\n  background-color: #f5f5f5;\r\n  padding: 10px;\r\n  border-radius: 4px;\r\n  font-family: monospace;\r\n  overflow-x: auto;\r\n  display: block;\r\n  margin: 10px 0;\r\n}\r\n\r\n::v-deep .deepseek-response code {\r\n  background-color: #f5f5f5;\r\n  padding: 2px 4px;\r\n  border-radius: 3px;\r\n  font-family: monospace;\r\n}\r\n\r\n::v-deep .deepseek-response table {\r\n  border-collapse: collapse;\r\n  width: 100%;\r\n  margin: 15px 0;\r\n}\r\n\r\n::v-deep .deepseek-response th,\r\n::v-deep .deepseek-response td {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n  text-align: left;\r\n}\r\n\r\n::v-deep .deepseek-response th {\r\n  background-color: #f2f2f2;\r\n  font-weight: bold;\r\n}\r\n\r\n::v-deep .deepseek-response h1,\r\n::v-deep .deepseek-response h2,\r\n::v-deep .deepseek-response h3,\r\n::v-deep .deepseek-response h4,\r\n::v-deep .deepseek-response h5,\r\n::v-deep .deepseek-response h6 {\r\n  margin-top: 20px;\r\n  margin-bottom: 10px;\r\n  font-weight: bold;\r\n  color: #222;\r\n}\r\n\r\n::v-deep .deepseek-response a {\r\n  color: #0066cc;\r\n  text-decoration: none;\r\n}\r\n\r\n::v-deep .deepseek-response blockquote {\r\n  border-left: 4px solid #ddd;\r\n  padding-left: 15px;\r\n  margin: 15px 0;\r\n  color: #555;\r\n}\r\n\r\n::v-deep .deepseek-response ul,\r\n::v-deep .deepseek-response ol {\r\n  padding-left: 20px;\r\n  margin: 10px 0;\r\n}\r\n</style>\r\n"]}]}